{% comment %}
  Quiz Step Section for Shopify
  Place multiple sections on a page to create a multi-step quiz

  Required files:
  - assets/quiz-section.css
  - assets/quiz-section.js
{% endcomment %}

{{ 'quiz-section.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .quiz-step-{{ section.id }} {
  --primary-color: {{ section.settings.primary_color }};
  --secondary-color: {{ section.settings.secondary_color }};
  --text-color: {{ section.settings.text_color }};
  --progress-color: {{ section.settings.progress_color }};
  --button-color: {{ section.settings.button_color }};
  --button-text-color: {{ section.settings.button_text_color }};
  --btn-border-radius: {{ section.settings.button_border_radius }};
  }

  #shopify-section-{{ section.id }}.quiz-section {
  background: {{ section.settings.background_color }};
  }

  {% if section.settings.answers_layout == 'two_columns' %}
    .quiz-step-{{ section.id }} .quiz-answers {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }
  {% else %}
    .quiz-step-{{ section.id }} .quiz-answers {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
  {% endif %}

  @media (max-width: 1024px) {
    {% if section.settings.answers_layout_mobile == 'two_columns' %}
      .quiz-step-{{ section.id }} .quiz-answers {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
      }
    {% else %}
      .quiz-step-{{ section.id }} .quiz-answers {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
    {% endif %}
  }
{%- endstyle -%}

<div
    class="quiz-step quiz-step-{{ section.id }}"
    data-quiz-step
    data-step-id="{{ section.id }}"
    data-question-id="{{ section.settings.question_id }}"
    data-multiple-choice="{{ section.settings.allow_multiple }}"
    data-free-text-mode="{{ section.settings.free_text_mode }}"
    data-conditional-parent="{{ section.settings.conditional_parent }}"
    data-conditional-value="{{ section.settings.conditional_value }}"
    data-order-note-position="{{ section.settings.order_note_position }}"
    style="display: none;"
>
  <div class="quiz-step-wrapper">
    <!-- Desktop Image (Left Column) -->
    {% if section.settings.desktop_image_female != blank or section.settings.desktop_image_male != blank %}
      <div class="quiz-step-image" data-quiz-image>
        {% if section.settings.desktop_image_female != blank %}
          <img 
            src="{{ section.settings.desktop_image_female | image_url: width: 1440 }}" 
            alt=""
            class="quiz-step-image-female"
            data-image-female
            loading="lazy"
          >
        {% endif %}
        {% if section.settings.desktop_image_male != blank %}
          <img 
            src="{{ section.settings.desktop_image_male | image_url: width: 1440 }}" 
            alt=""
            class="quiz-step-image-male"
            data-image-male
            loading="lazy"
            style="display: none;"
          >
        {% endif %}
      </div>
    {% endif %}

    <!-- Content (Right Column) -->
    <div class="quiz-step-content">
      <!-- Breadcrumbs -->
      <div class="quiz-step-breadcrumbs">
        <a href="{{ routes.root_url }}" class="quiz-step-breadcrumb-link">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" class="quiz-step-breadcrumb-icon">
            <path d="M15.8335 10.0001H4.16683M4.16683 10.0001L10.0002 4.16675M4.16683 10.0001L10.0002 15.8334" stroke="#232323" stroke-opacity="0.45" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span class="quiz-step-breadcrumb-text">Home</span>
        </a>
        <button type="button" class="quiz-step-mobile-next quiz-btn-next" data-next-btn style="display: none;">
          <span>Next</span>
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M7.5 15L12.5 10L7.5 5" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>

      <!-- Progress Bar -->
      <div class="quiz-step-progress-wrapper">
        <div class="quiz-step-progress-bar">
          <div class="quiz-step-progress-bar-track"></div>
          <div class="quiz-step-progress-bar-fill" data-progress-bar></div>
        </div>
        <div class="quiz-step-indicator" data-step-indicator></div>
      </div>

      <!-- Question Content -->
      <div class="quiz-step-question-content">
        <div class="quiz-step-question-header">
          <h2 class="quiz-step-question-title">
            {{ section.settings.question_title }}
            {% if section.settings.info_text != blank %}
              <button type="button" class="quiz-info-toggle" data-info-toggle aria-label="More information">
                <svg width="22" height="22" viewBox="0 0 20 20" fill="none">
                  <circle cx="10" cy="10" r="9" stroke="currentColor" stroke-width="1.5"/>
                  <path d="M10 14V10M10 6H10.01" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
              </button>
            {% endif %}
          </h2>
        </div>

        {% if section.settings.question_subtitle != blank %}
          <p class="quiz-step-question-subtitle">{{ section.settings.question_subtitle }}</p>
        {% endif %}

        {% if section.settings.question_description != blank %}
          <p class="quiz-step-question-description">{{ section.settings.question_description }}</p>
        {% endif %}

        {% if section.settings.info_text != blank %}
          <div class="quiz-info-popup" data-info-popup>
            <div class="quiz-info-popup-overlay" data-info-overlay></div>
            <div class="quiz-info-popup-content">
              <button type="button" class="quiz-info-popup-close" data-info-close aria-label="Close">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
              <div class="quiz-info-popup-body">
                {{ section.settings.info_text }}
              </div>
            </div>
          </div>
        {% endif %}

        <!-- Answers -->
        {% if section.settings.free_text_mode %}
          <!-- Free Text Mode -->
          <div class="quiz-free-text-fields" data-free-text-fields>
            {% for block in section.blocks %}
              {% if block.type == 'free_text_field' %}
                <div class="quiz-free-text-field" data-free-text-field>
                  <label class="free-text-label">{{ block.settings.field_label }}</label>
                  <textarea
                      class="free-text-textarea"
                      data-field-id="{{ block.settings.field_id }}"
                      placeholder="{{ block.settings.field_placeholder }}"
                      rows="{{ block.settings.field_rows }}"
                  ></textarea>
                </div>
              {% endif %}
            {% endfor %}
          </div>
        {% else %}
          <!-- Regular Answer Mode -->
          <div class="quiz-answers" data-answers>
            {% for block in section.blocks %}
              {% if block.type == 'answer' %}
                <label class="quiz-answer" data-answer-block>
                  <input
                      type="{% if section.settings.allow_multiple %}checkbox{% else %}radio{% endif %}"
                      name="question_{{ section.settings.question_id }}"
                      value="{{ block.settings.answer_id }}"
                      data-answer-value="{{ block.settings.answer_id }}"
                      data-answer-title="{{ block.settings.answer_title }}"
                      data-porosity="{{ block.settings.porosity_value }}"
                      data-elasticity="{{ block.settings.elasticity_value }}"
                      data-formulation-1="{{ block.settings.formulation_1 }}"
                      data-formulation-2="{{ block.settings.formulation_2 }}"
                      data-formulation-3="{{ block.settings.formulation_3 }}"
                      data-formulation-4="{{ block.settings.formulation_4 }}"
                      data-formulation-5="{{ block.settings.formulation_5 }}"
                      data-formulation-6="{{ block.settings.formulation_6 }}"
                      data-formulation-7="{{ block.settings.formulation_7 }}"
                      data-product-handles="{% assign product_handles = '' %}{% for product in block.settings.product_list %}{% if forloop.first %}{% assign product_handles = product.handle %}{% else %}{% assign product_handles = product_handles | append: ',' | append: product.handle %}{% endif %}{% endfor %}{{ product_handles }}"
                      data-product-handles-male="{% assign product_handles_male = '' %}{% for product in block.settings.product_list_male %}{% if forloop.first %}{% assign product_handles_male = product.handle %}{% else %}{% assign product_handles_male = product_handles_male | append: ',' | append: product.handle %}{% endif %}{% endfor %}{{ product_handles_male }}"
                  >
                  <div class="quiz-answer-content">
                    {% if block.settings.answer_image != blank %}
                      <div class="quiz-answer-image">
                        <img
                            src="{{ block.settings.answer_image | image_url: width: 400 }}"
                            alt="{{ block.settings.answer_title }}"
                            loading="lazy"
                        >
                      </div>
                    {% endif %}
                    <div class="quiz-answer-checkbox">
                      <div class="quiz-answer-checkbox-inner">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" class="quiz-answer-checkbox-inner-checked">
                          <path d="M10 3.87756C13.375 3.87756 16.1112 6.61392 16.1113 9.98889C16.1113 13.364 13.3751 16.1002 10 16.1002C6.62503 16.1001 3.88867 13.3639 3.88867 9.98889C3.88879 6.61399 6.6251 3.87768 10 3.87756Z" stroke="#1A365D" stroke-width="5.55556"/>
                        </svg>
                      </div>
                    </div>
                    <div class="quiz-answer-text">
                      <span>{{ block.settings.answer_title }}</span>
                    </div>
                    <div class="quiz-answer-check">
                      <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M16.6667 5L7.5 14.1667L3.33333 10" stroke="#232323" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </div>
                  </div>
                </label>
              {% endif %}
            {% endfor %}
          </div>
        {% endif %}
      </div>

      <!-- Navigation Buttons -->
      <div class="quiz-step-navigation">
        <button type="button" class="quiz-btn quiz-btn-back" data-back-btn style="display: none;">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M5.00033 6.66663L1.66699 9.99996M1.66699 9.99996L5.00033 13.3333M1.66699 9.99996H18.3337" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span class="quiz-btn-back-text">Previous</span>
        </button>
        <button type="button" class="quiz-btn quiz-btn-next" data-next-btn disabled>
          <span class="quiz-btn-next-text">Next</span>
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M15.0003 6.66663L18.3337 9.99996M18.3337 9.99996L15.0003 13.3333M18.3337 9.99996H1.66699" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </div>
  </div>
</div>

<style>
  #shopify-section-{{ section.id }}{
    padding: 0;
  }
  #shopify-section-{{ section.id }} .quiz-step-wrapper {
    display: flex;
    align-items: stretch;
    min-height: fit-content;
    height: calc(100vh - 136px);
    background: #f1f1f9;
  }

  /* Desktop Image */
  #shopify-section-{{ section.id }} .quiz-step-image {
    width: 100%;
    height: auto;
    overflow: hidden;
    position: relative;
    display: none;
  }

  #shopify-section-{{ section.id }} .quiz-step-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
  }

  #shopify-section-{{ section.id }} .quiz-step{
    min-height: fit-content;
    height: calc(100vh - 136px);
  }

  /* Content Column */
  #shopify-section-{{ section.id }} .quiz-step-content {
    width: 100%;
    display: flex;
    flex-direction: column;
    padding: 20px 60px 80px 60px;
    background: #f1f1f9;
    border-left: 1px solid white;
    position: relative;
    min-height: fit-content;
    height: calc(100vh - 136px);
  }

  @media(max-width: 1024px){
    #shopify-section-{{ section.id }} .quiz-step-content {
      max-width: 100%;
    }
  }

  /* Breadcrumbs */
  #shopify-section-{{ section.id }} .quiz-step-breadcrumbs {
    padding: 20px 0;
    width: 100%;
  }

  #shopify-section-{{ section.id }} .quiz-answer-checkbox-inner-checked{
    display: none;
  }

  #shopify-section-{{ section.id }} .quiz-step-breadcrumb-link {
    display: flex;
    align-items: center;
    gap: 8px;
    text-decoration: none;
    color: rgba(35, 35, 35, 0.45);
    font-family: 'Gotham', sans-serif;
    font-size: 14px;
    font-weight: 400;
    line-height: 1.5;
    transition: color 0.2s;
  }

  #shopify-section-{{ section.id }} .quiz-step-breadcrumb-link:hover {
    color: rgba(35, 35, 35, 0.7);
  }

  #shopify-section-{{ section.id }} .quiz-step-breadcrumb-icon {
    width: 20px;
    height: 20px;
  }

  #shopify-section-{{ section.id }} .quiz-step-breadcrumb-text {
    font-family: 'Gotham', sans-serif;
    font-size: 14px;
    font-weight: 400;
    line-height: 1.5;
  }

  /* Progress Bar */
  #shopify-section-{{ section.id }} .quiz-step-progress-wrapper {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 24px;
  }

  #shopify-section-{{ section.id }} .quiz-step-progress-bar {
    position: relative;
    width: 100%;
    height: 3px;
  }

  #shopify-section-{{ section.id }} .quiz-step-progress-bar-track {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 3px;
    background: rgba(28, 28, 28, 0.1);
    border-radius: 999px;
  }

  #shopify-section-{{ section.id }} .quiz-step-progress-bar-fill {
    position: absolute;
    top: 0;
    left: 0;
    height: 3px;
    background: #1a365d;
    border-radius: 999px;
    width: 0%;
    transition: width 0.3s ease;
  }

  /* Ensure minimum width for first question */
  #shopify-section-{{ section.id }} .quiz-step-progress-bar-fill[style*="width: 0%"],
  #shopify-section-{{ section.id }} .quiz-step-progress-bar-fill[style*="width:0%"] {
    width: 26px !important;
  }

  #shopify-section-{{ section.id }} .quiz-step-indicator {
    font-family: 'Gotham', sans-serif;
    font-size: 14px;
    font-weight: 400;
    line-height: 1.5;
    color: rgba(35, 35, 35, 0.75);
    text-align: center;
  }

  #shopify-section-{{ section.id }} .quiz-answer-checkbox-inner{
    display: flex;
    width: 100%;
    height: 100%;
  }

  #shopify-section-{{ section.id }} .quiz-answer-checkbox-inner{
    width: 100%;
    height: 100%;
  }

  /* Question Content */
  #shopify-section-{{ section.id }} .quiz-step-question-content {
    display: flex;
    flex-direction: column;
    gap: 24px;
    flex: 1;
  }

  #shopify-section-{{ section.id }} .quiz-step-question-title {
    font-family: 'Vanilla Ravioli', sans-serif;
    font-size: 32px;
    font-weight: 400;
    line-height: 1.3;
    color: #232323;
    text-transform: capitalize;
    margin: 0;
    width: 100%;
  }

  #shopify-section-{{ section.id }} .quiz-step-question-subtitle {
    font-family: 'Gotham', sans-serif;
    font-size: 14px;
    font-weight: 400;
    line-height: 1.5;
    color: #272727;
    margin: 0;
    max-width: 480px;
  }

  #shopify-section-{{ section.id }} .quiz-step-question-description {
    font-family: 'Gotham', sans-serif;
    font-size: 14px;
    font-weight: 400;
    line-height: 1.5;
    color: #272727;
    margin: 0;
    max-width: 480px;
  }

  /* Answers */
  #shopify-section-{{ section.id }} .quiz-answers {
    width: 100%;
  }

  #shopify-section-{{ section.id }} .quiz-answer {
    display: block;
    cursor: pointer;
    position: relative;
  }

  #shopify-section-{{ section.id }} .quiz-answer input {
    position: absolute;
    opacity: 0;
    pointer-events: none;
  }

  #shopify-section-{{ section.id }} .quiz-answer-content {
    display: flex;
    align-items: center;
    flex-direction: row;
    gap: 12px!important;
    padding: 8px 16px;
    background: white;
    border: 1px solid #e0e0f1;
    border-radius: 12px 8px 12px 12px;
    transition: all 0.2s;
  }

  #shopify-section-{{ section.id }} .quiz-answer input:checked + .quiz-answer-content {
    background: #fffbc0;
    border: 1.5px solid #ece9b2;
    border-radius: 12px;
  }

  /* For answers with images */
  #shopify-section-{{ section.id }} .quiz-answer-image {
    width: 147px;
    height: 96px;
    flex-shrink: 0;
    border-radius: 12px;
    overflow: hidden;
    margin-right: 6px;
  }

  #shopify-section-{{ section.id }} .quiz-answer-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* When answer has image, adjust layout */
  #shopify-section-{{ section.id }} .quiz-answer:has(.quiz-answer-image) .quiz-answer-content {
    gap: 18px;
    padding: 0;
    height: auto;
    min-height: 96px;
    border-radius: 18px;
  }

  #shopify-section-{{ section.id }} .quiz-answer:has(.quiz-answer-image) input:checked + .quiz-answer-content {
    border-radius: 18px;
  }

  /* Two-column layout adjustments */
  {% if section.settings.answers_layout == 'two_columns' %}
    #shopify-section-{{ section.id }} .quiz-answers {
      display: grid !important;
      grid-template-columns: repeat(2, 1fr) !important;
    }
  {% endif %}

  @media (max-width: 1300px) {
    {% if section.settings.answers_layout == 'two_columns' %}
      #shopify-section-{{ section.id }} .quiz-answers {
        display: grid !important;
        grid-template-columns: repeat(1, 1fr) !important;
      }
    {% else %}
      #shopify-section-{{ section.id }} .quiz-answers {
        display: flex !important;
        flex-direction: column !important;
      }
    {% endif %}
  }

  @media (max-width: 1024px) {
    {% if section.settings.answers_layout_mobile == 'two_columns' %}
      #shopify-section-{{ section.id }} .quiz-answers {
        display: grid !important;
        grid-template-columns: repeat(2, 1fr) !important;
      }
    {% else %}
      #shopify-section-{{ section.id }} .quiz-answers {
        display: flex !important;
        flex-direction: column !important;
      }
    {% endif %}
  }

  #shopify-section-{{ section.id }} .quiz-answer-image {
    width: 147px;
    height: 96px;
    flex-shrink: 0;
    border-radius: 12px;
    overflow: hidden;
  }

  #shopify-section-{{ section.id }} .quiz-answer-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  #shopify-section-{{ section.id }} .quiz-answer-checkbox {
    width: 20px;
    height: 20px;
    flex-shrink: 0;
    border: 1px solid rgba(0, 0, 0, 0.15);
    border-radius: 10px;
    background: #fdfdfe;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  #shopify-section-{{ section.id }} .quiz-answer-text {
    flex: 1;
    font-family: 'Gotham', sans-serif;
    font-size: 16px;
    font-weight: 400;
    line-height: 1.5;
    color: #232323;
    padding-left: 0;
  }

  #shopify-section-{{ section.id }} .quiz-answer-check {
    width: 20px;
    height: 20px;
    flex-shrink: 0;
    display: none;
  }

  #shopify-section-{{ section.id }} .quiz-answer input:checked + .quiz-answer-content .quiz-answer-check {
    display: none;
  }

  /* Hide checkbox when answer is selected */
  #shopify-section-{{ section.id }} .quiz-answer input:checked + .quiz-answer-content::before {
    display: none;
  }

  /* Navigation Buttons */
  #shopify-section-{{ section.id }} .quiz-step-navigation {
    display: flex;
    gap: 20px;
    margin-top: auto;
    padding-top: 44px;
  }

  #shopify-section-{{ section.id }} .quiz-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    padding: 16px 32px;
    height: 56px;
    border: none;
    border-radius: 16px;
    font-family: 'Gotham', sans-serif;
    font-size: 14px;
    font-weight: 500;
    line-height: 1.5;
    cursor: pointer;
    transition: all 0.2s;
    flex: 1;
  }

  #shopify-section-{{ section.id }} .quiz-btn-back {
    background: white;
    border: 1px solid #d4d9e1;
    color: #272727;
  }

  #shopify-section-{{ section.id }} .quiz-btn-back:hover {
    background: #f7f7fc;
  }

  #shopify-section-{{ section.id }} .quiz-btn-next {
    background: #1a365d;
    color: #fcfefe;
    gap: 8px;
  }

  #shopify-section-{{ section.id }} .quiz-btn-next:hover:not(:disabled) {
    background: #152a4a;
  }

  #shopify-section-{{ section.id }} .quiz-btn-next:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  #shopify-section-{{ section.id }} .quiz-btn svg {
    width: 24px;
    height: 24px;
    flex-shrink: 0;
  }

  /* Free Text Fields */
  #shopify-section-{{ section.id }} .quiz-free-text-fields {
    display: flex;
    flex-direction: column;
    gap: 24px;
    margin: 32px 0;
  }

  #shopify-section-{{ section.id }} .quiz-free-text-field {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  #shopify-section-{{ section.id }} .free-text-label {
    font-size: 15px;
    font-weight: 500;
    color: var(--text-color, #111827);
  }

  #shopify-section-{{ section.id }} .free-text-textarea {
    width: 100%;
    padding: 12px 14px;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    font-size: 15px;
    font-family: inherit;
    color: #111827;
    background: #fff;
    transition: border-color 0.2s;
    resize: vertical;
    line-height: 1.5;
  }

  #shopify-section-{{ section.id }} .free-text-textarea:focus {
    outline: none;
    border-color: var(--primary-color, #000);
  }

  #shopify-section-{{ section.id }} .free-text-textarea::placeholder {
    color: #9ca3af;
  }

  /* Mobile Styles */
  @media (min-width: 1025px) {
    #shopify-section-{{ section.id }} .quiz-step-image {
      display: block;
    }
  }

  @media (max-width: 1024px) {
    #shopify-section-{{ section.id }} .quiz-step-wrapper {
      flex-direction: column;
    }

    #shopify-section-{{ section.id }} .quiz-step-image {
      display: none;
    }

    #shopify-section-{{ section.id }} .quiz-step-content {
      padding: 0 20px 20px 20px;
      border-left: none;
      min-height: auto;
    }

    #shopify-section-{{ section.id }} .quiz-step-breadcrumbs {
      padding: 20px 0;
    }

    #shopify-section-{{ section.id }}{
      padding: 0;
    }

    #shopify-section-{{ section.id }} .quiz-step-breadcrumbs {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
    }

    #shopify-section-{{ section.id }} .quiz-step-breadcrumb-link {
      flex: 1;
    }

    #shopify-section-{{ section.id }} .quiz-step-breadcrumb-link {
      position: relative;
    }

    #shopify-section-{{ section.id }} .quiz-step-mobile-next {
      display: none;
      align-items: center;
      gap: 12px;
      padding: 8px 16px;
      background: #1a365d;
      border-radius: 8px;
      color: white;
      font-family: 'Gotham', sans-serif;
      font-size: 14px;
      font-weight: 400;
      text-decoration: none;
      border: none;
      cursor: pointer;
      margin-left: auto;
    }

    #shopify-section-{{ section.id }} .quiz-step-mobile-next:not(:disabled) {
      display: flex;
    }

    #shopify-section-{{ section.id }} .quiz-step-mobile-next:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    #shopify-section-{{ section.id }} .quiz-step-progress-bar {
      height: 3px;
    }

    #shopify-section-{{ section.id }} .quiz-step-progress-bar-track {
      height: 3px;
    }

    #shopify-section-{{ section.id }} .quiz-step-progress-bar-fill {
      height: 3px;
    }

    #shopify-section-{{ section.id }} .quiz-step-indicator {
      display: none;
    }

    #shopify-section-{{ section.id }} .quiz-step-question-content {
      gap: 24px;
      padding-top: 0;
    }

    #shopify-section-{{ section.id }} .quiz-step-question-title {
      font-size: 24px;
      line-height: 1.4;
      color: #272727;
    }

    #shopify-section-{{ section.id }} .quiz-step-question-subtitle {
      font-size: 12px;
      max-width: 100%;
    }

    #shopify-section-{{ section.id }} .quiz-answer-content {
      padding: 12px 16px;
    }

    #shopify-section-{{ section.id }} .quiz-answer-text {
      font-size: 14px;
    }

    #shopify-section-{{ section.id }} .quiz-step-navigation {
      gap: 10px;
      padding-top: 20px;
    }

    #shopify-section-{{ section.id }} .quiz-btn {
      padding: 12px 24px;
      height: auto;
      border-radius: 12px;
      gap: 12px;
    }

    #shopify-section-{{ section.id }} .quiz-btn-back-text,
    #shopify-section-{{ section.id }} .quiz-btn-next-text {
      font-size: 14px;
    }

    #shopify-section-{{ section.id }} .quiz-btn svg {
      width: 20px;
      height: 20px;
    }
  }

  @media (max-width: 1024px) {
      #shopify-section-{{ section.id }} .quiz-step{
        height: auto;
      }

      #shopify-section-{{ section.id }} quiz-step-wrapper{
        height: auto;
      }

      #shopify-section-{{ section.id }} .quiz-step-content{
        height: auto;
      }
  }
</style>


{% schema %}
{
  "name": "Quiz Step",
  "class": "quiz-section",
  "settings": [
    {
      "type": "text",
      "id": "question_id",
      "label": "Question ID",
      "info": "Unique identifier for this question (e.g., 'hair_type'). Use this ID in results template as [[question_id]]",
      "default": "question_1"
    },
    {
      "type": "text",
      "id": "question_title",
      "label": "Question Title",
      "default": "What is your hair type?"
    },
    {
      "type": "textarea",
      "id": "question_subtitle",
      "label": "Question Subtitle (optional)",
      "info": "Short description that appears directly under the title"
    },
    {
      "type": "textarea",
      "id": "question_description",
      "label": "Question Description (optional)",
      "info": "Additional context or instructions for this question"
    },
    {
      "type": "richtext",
      "id": "info_text",
      "label": "Additional Information (optional)",
      "info": "Expandable info panel for this question"
    },
    {
      "type": "header",
      "content": "Desktop Images"
    },
    {
      "type": "image_picker",
      "id": "desktop_image_female",
      "label": "Desktop Image (Female)",
      "info": "Image shown on desktop when user selects female gender"
    },
    {
      "type": "image_picker",
      "id": "desktop_image_male",
      "label": "Desktop Image (Male)",
      "info": "Image shown on desktop when user selects male gender"
    },
    {
      "type": "checkbox",
      "id": "free_text_mode",
      "label": "Free Text Mode",
      "default": false,
      "info": "Enable to make this a free text question. Add 'Free Text Field' blocks instead of Answer blocks."
    },
    {
      "type": "checkbox",
      "id": "allow_multiple",
      "label": "Allow Multiple Answers",
      "default": false,
      "info": "Enable to allow users to select multiple answers (only for regular answer mode)"
    },
    {
      "type": "text",
      "id": "conditional_parent",
      "label": "Conditional Parent Question ID (optional)",
      "info": "Hide this question unless a specific answer is selected in parent question"
    },
    {
      "type": "text",
      "id": "conditional_value",
      "label": "Required Parent Answer ID",
      "info": "The answer ID from parent question that must be selected to show this question"
    },
    {
      "type": "number",
      "id": "order_note_position",
      "label": "Order Note Position",
      "info": "Controls the order this question appears in the order note (lower numbers appear first).",
      "default": 10
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "answers_layout",
      "label": "Answer Layout - Desktop",
      "options": [
        {
          "value": "one_column",
          "label": "One Column (Stacked)"
        },
        {
          "value": "two_columns",
          "label": "Two Columns (Side by Side)"
        }
      ],
      "default": "one_column",
      "info": "Choose how answers are displayed on desktop screens"
    },
    {
      "type": "select",
      "id": "answers_layout_mobile",
      "label": "Answer Layout - Mobile",
      "options": [
        {
          "value": "one_column",
          "label": "One Column (Stacked)"
        },
        {
          "value": "two_columns",
          "label": "Two Columns (Side by Side)"
        }
      ],
      "default": "one_column",
      "info": "Choose how answers are displayed on mobile screens"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 1,
      "max": 6,
      "step": 1,
      "label": "Columns - Desktop (Legacy)",
      "default": 2,
      "info": "Legacy setting - use Answer Layout instead"
    },
    {
      "type": "range",
      "id": "columns_tablet",
      "min": 1,
      "max": 6,
      "step": 1,
      "label": "Columns - Tablet (Legacy)",
      "default": 2,
      "info": "Legacy setting - use Answer Layout instead"
    },
    {
      "type": "range",
      "id": "columns_mobile",
      "min": 1,
      "max": 6,
      "step": 1,
      "label": "Columns - Mobile (Legacy)",
      "default": 1,
      "info": "Legacy setting - use Answer Layout instead"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "primary_color",
      "label": "Primary Color",
      "default": "#A6A8DE"
    },
    {
      "type": "color",
      "id": "secondary_color",
      "label": "Secondary Color",
      "default": "#D9DAF4"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#102B26"
    },
    {
      "type": "color",
      "id": "progress_color",
      "label": "Progress Bar Color",
      "default": "#10b981"
    },
    {
      "type": "color",
      "id": "button_color",
      "label": "Button Background Color",
      "default": "#A6A8DE"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button Text Color",
      "default": "#ffffff"
    },
    {
      "type": "text",
      "id": "button_border_radius",
      "label": "Button Border Radius",
      "default": "5rem",
      "info": "CSS value for button border radius (e.g., 5rem, 8px, 50%)"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#f0f0ff"
    }
  ],
  "blocks": [
    {
      "type": "answer",
      "name": "Answer",
      "settings": [
        {
          "type": "text",
          "id": "answer_id",
          "label": "Answer ID",
          "info": "Unique identifier for this answer (e.g., 'thick', 'thin')",
          "default": "answer_1"
        },
        {
          "type": "text",
          "id": "answer_title",
          "label": "Answer Title",
          "default": "Option 1"
        },
        {
          "type": "image_picker",
          "id": "answer_image",
          "label": "Answer Image (optional)"
        },
        {
          "type": "header",
          "content": "Internal Calculations (Not visible to user)"
        },
        {
          "type": "select",
          "id": "porosity_value",
          "label": "Porosity",
          "options": [
            {
              "value": "none",
              "label": "Not Set"
            },
            {
              "value": "low",
              "label": "Low (a)"
            },
            {
              "value": "medium",
              "label": "Medium (b)"
            },
            {
              "value": "high",
              "label": "High (c)"
            }
          ],
          "default": "none",
          "info": "For internal calculations only"
        },
        {
          "type": "select",
          "id": "elasticity_value",
          "label": "Elasticity",
          "options": [
            {
              "value": "none",
              "label": "Not Set"
            },
            {
              "value": "low",
              "label": "Low (a)"
            },
            {
              "value": "medium",
              "label": "Medium (b)"
            },
            {
              "value": "high",
              "label": "High (c)"
            }
          ],
          "default": "none",
          "info": "For internal calculations only"
        },
        {
          "type": "number",
          "id": "formulation_1",
          "label": "Formulation - Product 1",
          "info": "Formulation value for the first product in the list"
        },
        {
          "type": "number",
          "id": "formulation_2",
          "label": "Formulation - Product 2",
          "info": "Formulation value for the second product in the list"
        },
        {
          "type": "number",
          "id": "formulation_3",
          "label": "Formulation - Product 3",
          "info": "Formulation value for the third product in the list"
        },
        {
          "type": "number",
          "id": "formulation_4",
          "label": "Formulation - Product 4",
          "info": "Formulation value for the fourth product in the list"
        },
        {
          "type": "number",
          "id": "formulation_5",
          "label": "Formulation - Product 5",
          "info": "Formulation value for the fifth product in the list"
        },
        {
          "type": "number",
          "id": "formulation_6",
          "label": "Formulation - Product 6",
          "info": "Formulation value for the sixth product in the list"
        },
        {
          "type": "number",
          "id": "formulation_7",
          "label": "Formulation - Product 7",
          "info": "Formulation value for the seventh product in the list"
        },
        {
          "type": "product_list",
          "id": "product_list",
          "label": "Recommended Products Female (optional)",
          "info": "Select multiple products to recommend when this answer is selected",
          "limit": 10
        },
        {
          "type": "product_list",
          "id": "product_list_male",
          "label": "Recommended Products Male (optional)",
          "info": "Select multiple products to recommend for male users when this answer is selected",
          "limit": 10
        }
      ]
    },
    {
      "type": "free_text_field",
      "name": "Free Text Field",
      "settings": [
        {
          "type": "text",
          "id": "field_id",
          "label": "Field ID",
          "info": "Unique identifier for this field (e.g., 'first_name', 'email')",
          "default": "field_1"
        },
        {
          "type": "text",
          "id": "field_label",
          "label": "Field Label",
          "default": "Your Name"
        },
        {
          "type": "text",
          "id": "field_placeholder",
          "label": "Placeholder Text",
          "default": "Enter your answer here..."
        },
        {
          "type": "range",
          "id": "field_rows",
          "label": "Number of Rows",
          "min": 1,
          "max": 10,
          "step": 1,
          "default": 3
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Quiz Step",
      "blocks": [
        {
          "type": "answer",
          "settings": {
            "answer_id": "option_1",
            "answer_title": "Option 1"
          }
        },
        {
          "type": "answer",
          "settings": {
            "answer_id": "option_2",
            "answer_title": "Option 2"
          }
        }
      ]
    }
  ]
}
{% endschema %}
