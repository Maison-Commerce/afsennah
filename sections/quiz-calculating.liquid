{% comment %}
  Quiz Calculating Section for Shopify
  Place this section BETWEEN quiz steps and quiz results
{% endcomment %}

{{ 'quiz-section.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .quiz-calculating-{{ section.id }} {
  --primary-color: {{ section.settings.primary_color }};
  --text-color: {{ section.settings.text_color }};
  --button-color: {{ section.settings.button_color }};
  --button-text-color: {{ section.settings.button_text_color }};
  --btn-border-radius: {{ section.settings.button_border_radius }};
  }

  .quiz-calculating-{{ section.id }}.quiz-section {
  background: {{ section.settings.background_color }};
  }
{%- endstyle -%}

<div class="quiz-calculating quiz-calculating-{{ section.id }}" data-calculating style="display: none;">
  <div class="quiz-calculating-wrapper">
    <!-- Left Column - Reviews (Desktop Only) -->
    {% if section.blocks.size > 0 %}
      <div class="quiz-calculating-reviews-column">
        <div class="quiz-calculating-reviews-container">
          {% for block in section.blocks %}
            {% assign opacity = 100 %}
            {% if forloop.index == 1 %}
              {% assign opacity = 40 %}
            {% elsif forloop.index == 2 %}
              {% assign opacity = 70 %}
            {% elsif forloop.index == 4 %}
              {% assign opacity = 70 %}
            {% elsif forloop.index == 5 %}
              {% assign opacity = 40 %}
            {% endif %}
            <div class="quiz-calculating-review-card" style="opacity: {{ opacity }}%;" {{ block.shopify_attributes }}>
              <div class="quiz-calculating-review-content">
                <div class="quiz-calculating-review-stars">
                  {% for i in (1..5) %}
                    <svg width="16" height="16" viewBox="0 0 20 20" fill="none">
                      <path d="M10 1.66669L12.575 6.88335L18.3333 7.72502L14.1667 11.7834L15.15 17.5167L10 14.8084L4.85 17.5167L5.83333 11.7834L1.66667 7.72502L7.425 6.88335L10 1.66669Z" fill="#E98C36" stroke="#E98C36" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  {% endfor %}
                </div>
                <div class="quiz-calculating-review-text">{{ block.settings.review_text }}</div>
                <div class="quiz-calculating-review-author">
                  <span class="quiz-calculating-review-author-name">{{ block.settings.author_name }}</span>
                  <svg width="4" height="4" viewBox="0 0 4 4" fill="none" class="quiz-calculating-review-dot">
                    <circle cx="2" cy="2" r="2" fill="#2C2926"/>
                  </svg>
                  <div class="quiz-calculating-review-verified">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                      <g clip-path="url(#clip0_10099_17521{{ forloop.index }})">
                        <path d="M15.1466 6.89999L13.9199 5.91332C13.8216 5.83481 13.7453 5.73209 13.6985 5.61523C13.6518 5.49836 13.6362 5.37136 13.6533 5.24666L13.8199 3.68666C13.8431 3.47937 13.8194 3.26953 13.7506 3.07262C13.6819 2.87571 13.5698 2.69675 13.4226 2.54895C13.2754 2.40114 13.097 2.28826 12.9003 2.21864C12.7037 2.14901 12.494 2.12441 12.2866 2.14666L10.7199 2.31332C10.5952 2.33042 10.4682 2.31483 10.3514 2.26808C10.2345 2.22134 10.1318 2.14504 10.0533 2.04666L9.08661 0.839991C8.95144 0.684533 8.78449 0.559886 8.59702 0.474468C8.40956 0.38905 8.20595 0.344849 7.99995 0.344849C7.79394 0.344849 7.59033 0.38905 7.40287 0.474468C7.2154 0.559886 7.04845 0.684533 6.91328 0.839991L5.92661 2.06666C5.8481 2.16504 5.74538 2.24134 5.62852 2.28808C5.51165 2.33483 5.38465 2.35042 5.25995 2.33332L3.71328 2.16666C3.50589 2.14441 3.29616 2.16901 3.09955 2.23864C2.90294 2.30826 2.72447 2.42114 2.5773 2.56895C2.43014 2.71675 2.31804 2.89571 2.24926 3.09262C2.18049 3.28953 2.1568 3.49937 2.17995 3.70666L2.34661 5.26666C2.36371 5.39136 2.34812 5.51836 2.30137 5.63523C2.25463 5.75209 2.17833 5.85481 2.07995 5.93332L0.853279 6.89999C0.690594 7.03055 0.5593 7.19597 0.469084 7.38405C0.378867 7.57213 0.332031 7.77806 0.332031 7.98666C0.332031 8.19525 0.378867 8.40119 0.469084 8.58927C0.5593 8.77734 0.690594 8.94276 0.853279 9.07332L2.07995 10.06C2.17782 10.1389 2.25375 10.2417 2.30045 10.3585C2.34715 10.4752 2.36305 10.602 2.34661 10.7267L2.17995 12.2933C2.15684 12.5002 2.18082 12.7096 2.25009 12.9058C2.31936 13.1021 2.43212 13.2801 2.57995 13.4267C2.72435 13.5774 2.90214 13.6921 3.09899 13.7616C3.29584 13.8311 3.50625 13.8534 3.71328 13.8267L5.27995 13.66C5.40465 13.6429 5.53165 13.6585 5.64852 13.7052C5.76538 13.752 5.8681 13.8283 5.94661 13.9267L6.93328 15.1533C7.06384 15.316 7.22926 15.4473 7.41734 15.5375C7.60542 15.6277 7.81135 15.6746 8.01995 15.6746C8.22854 15.6746 8.43448 15.6277 8.62255 15.5375C8.81063 15.4473 8.97605 15.316 9.10661 15.1533L10.0933 13.9267C10.1718 13.8283 10.2745 13.752 10.3914 13.7052C10.5082 13.6585 10.6352 13.6429 10.7599 13.66L12.3266 13.8267C12.5336 13.8534 12.7441 13.8311 12.9409 13.7616C13.1378 13.6921 13.3155 13.5774 13.4599 13.4267C13.6078 13.2801 13.7205 13.1021 13.7898 12.9058C13.8591 12.7096 13.8831 12.5002 13.8599 12.2933L13.6933 10.7267C13.6768 10.602 13.6927 10.4752 13.7394 10.3585C13.7861 10.2417 13.8621 10.1389 13.9599 10.06L15.1866 9.07332C15.3493 8.94276 15.4806 8.77734 15.5708 8.58927C15.661 8.40119 15.7079 8.19525 15.7079 7.98666C15.7079 7.77806 15.661 7.57213 15.5708 7.38405C15.4806 7.19597 15.3493 7.03055 15.1866 6.89999H15.1466ZM8.26661 10.0333C8.16388 10.167 8.03399 10.2774 7.88549 10.3573C7.73699 10.4371 7.57325 10.4846 7.40507 10.4966C7.23689 10.5085 7.06808 10.4847 6.90977 10.4267C6.75146 10.3687 6.60724 10.2778 6.48661 10.16L4.85995 8.53332C4.79779 8.47117 4.74848 8.39737 4.71484 8.31616C4.6812 8.23494 4.66388 8.1479 4.66388 8.05999C4.66388 7.88246 4.73441 7.71219 4.85995 7.58666C4.98548 7.46112 5.15574 7.3906 5.33328 7.3906C5.51081 7.3906 5.68108 7.46112 5.80661 7.58666L7.33328 9.08666L9.93995 5.61332C10.046 5.47188 10.204 5.37836 10.379 5.35336C10.554 5.32835 10.7318 5.3739 10.8733 5.47999C11.0147 5.58608 11.1082 5.74401 11.1332 5.91904C11.1583 6.09408 11.1127 6.27188 11.0066 6.41332L8.26661 10.0333Z" fill="#1A365D"/>
                      </g>
                      <defs>
                        <clipPath id="clip0_10099_17521{{ forloop.index }}">
                          <rect width="16" height="16" fill="white"/>
                        </clipPath>
                      </defs>
                    </svg>
                    <span class="quiz-calculating-review-verified-text">Verified Buyer</span>
                  </div>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    {% endif %}

    <!-- Right Column - Content -->
    <div class="quiz-calculating-content-column">
      <!-- Breadcrumbs -->
      <div class="quiz-calculating-breadcrumbs">
        <a href="{{ routes.root_url }}" class="quiz-calculating-breadcrumb-link">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" class="quiz-calculating-breadcrumb-icon">
            <path d="M15.8335 10.0001H4.16683M4.16683 10.0001L10.0002 4.16675M4.16683 10.0001L10.0002 15.8334" stroke="#232323" stroke-opacity="0.45" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span class="quiz-calculating-breadcrumb-text">Home</span>
        </a>
        <button type="button" class="quiz-calculating-mobile-next" data-view-results-btn>
          <span>Next</span>
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M7.5 15L12.5 10L7.5 5" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>

      <!-- Progress Bar -->
      <div class="quiz-calculating-progress-wrapper">
        <div class="quiz-calculating-progress-bar">
          <div class="quiz-calculating-progress-bar-track"></div>
          <div class="quiz-calculating-progress-bar-fill"></div>
        </div>
        <div class="quiz-calculating-step-indicator" data-step-indicator></div>
      </div>

      <!-- Main Content -->
      <div class="quiz-calculating-main-content">
        {% if section.settings.title != blank %}
          <h2 class="quiz-calculating-title">{{ section.settings.title }}</h2>
        {% endif %}

        {% if section.settings.subtitle != blank %}
          <p class="quiz-calculating-subtitle">{{ section.settings.subtitle }}</p>
        {% endif %}

        <button type="button" class="quiz-calculating-button" data-view-results-btn>
          <span>{{ section.settings.button_text }}</span>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 20 20" fill="none">
            <path d="M15.0003 6.66663L18.3337 9.99996M18.3337 9.99996L15.0003 13.3333M18.3337 9.99996H1.66699" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>

      <!-- Product Image -->
      {% if section.settings.product_image != blank %}
        <div class="quiz-calculating-products">
          <div class="quiz-calculating-product-image">
            <img src="{{ section.settings.product_image | image_url: width: 1200 }}" alt="" loading="lazy">
          </div>
        </div>
      {% endif %}

      <!-- Mobile Reviews Carousel -->
      {% if section.blocks.size > 0 %}
        <div class="quiz-calculating-mobile-reviews">
          <div class="quiz-calculating-mobile-reviews-container">
            {% for block in section.blocks %}
              <div class="quiz-calculating-mobile-review-card" {{ block.shopify_attributes }}>
                <div class="quiz-calculating-mobile-review-content">
                  <div class="quiz-calculating-mobile-review-stars">
                    {% for i in (1..5) %}
                      <svg width="12" height="12" viewBox="0 0 20 20" fill="none">
                        <path d="M10 1.66669L12.575 6.88335L18.3333 7.72502L14.1667 11.7834L15.15 17.5167L10 14.8084L4.85 17.5167L5.83333 11.7834L1.66667 7.72502L7.425 6.88335L10 1.66669Z" fill="#E98C36" stroke="#E98C36" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    {% endfor %}
                  </div>
                  <div class="quiz-calculating-mobile-review-text">{{ block.settings.review_text }}</div>
                  <div class="quiz-calculating-mobile-review-author">
                    <span class="quiz-calculating-mobile-review-author-name">{{ block.settings.author_name }}</span>
                    <svg width="3" height="3" viewBox="0 0 3 3" fill="none" class="quiz-calculating-mobile-review-dot">
                      <circle cx="1.5" cy="1.5" r="1.5" fill="#2C2926"/>
                    </svg>
                    <div class="quiz-calculating-mobile-review-verified">
                      <svg width="12" height="12" viewBox="0 0 16 16" fill="none">
                        <path d="M8 0L10.06 5.90667L16 6.82667L11.3333 11.1733L12.12 17.3333L8 14.6667L3.88 17.3333L4.66667 11.1733L0 6.82667L5.94 5.90667L8 0Z" fill="#2C2926"/>
                      </svg>
                      <span class="quiz-calculating-mobile-review-verified-text">Verified Buyer</span>
                    </div>
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
      {% endif %}
    </div>
  </div>
</div>

<style>
  /* Base Styles */
  #shopify-section-{{ section.id }} .quiz-calculating-wrapper {
    display: flex;
    align-items: stretch;
    min-height: calc(100vh - 136px);
    height: calc(100vh - 136px);
    background: #f1f1f9;
  }

  /* Left Column - Reviews (Desktop) */
  #shopify-section-{{ section.id }} .quiz-calculating-reviews-column {
    width: 100%;
    background: #cccce8;
    padding: 70px 62px;
    display: none;
    overflow-y: auto;
    max-height: 100vh;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-reviews-container {
    display: flex;
    flex-direction: column;
    gap: 24px;
    align-items: center;
    justify-content: center;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-review-card {
    width: 410px;
    background: white;
    border-radius: 24px;
    box-shadow: 0px 2px 8px rgba(0, 0, 0, 0.06);
    overflow: hidden;
    transition: opacity 0.3s;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-review-content {
    display: flex;
    flex-direction: column;
    gap: 12px;
    padding: 16px;
    align-items: center;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-review-stars {
    display: flex;
    gap: 0;
    align-items: center;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-review-text {
    font-family: 'Gotham', sans-serif;
    font-size: 16px;
    font-weight: 400;
    line-height: 1.5;
    color: rgba(29, 33, 30, 0.75);
    text-align: center;
    margin: 0;
    width: 100%;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-review-text p {
    margin: 0;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-review-author {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
    padding: 4px 12px;
    background: #f1f1f9;
    border-radius: 56px;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-review-author-name {
    font-family: 'Neue Haas Grotesk Display Pro', sans-serif;
    font-size: 12px;
    font-weight: 500;
    line-height: 1.5;
    color: #2c2926;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-review-dot {
    flex-shrink: 0;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-review-verified {
    display: flex;
    align-items: center;
    gap: 4px;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-review-verified-text {
    font-family: 'Gotham', sans-serif;
    font-size: 12px;
    font-weight: 500;
    line-height: 1.5;
    color: #2c2926;
  }

  #shopify-section-{{ section.id }}{
    padding: 0;
  }

  #shopify-section-{{ section.id }} .quiz-calculating{
    min-height: calc(100vh - 136px);
    height: calc(100vh - 136px);
  }

  /* Right Column - Content */
  #shopify-section-{{ section.id }} .quiz-calculating-content-column {
    width: 100%;
    display: flex;
    flex-direction: column;
    padding: 20px 60px 80px 60px;
    background: #f1f1f9;
    border-left: 1px solid white;
    position: relative;
    min-height: calc(100vh - 136px);
    height: calc(100vh - 136px);
    justify-content: space-between;
  }

  /* Breadcrumbs */
  #shopify-section-{{ section.id }} .quiz-calculating-breadcrumbs {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 20px 0;
    width: 100%;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-breadcrumb-link {
    display: flex;
    align-items: center;
    gap: 8px;
    text-decoration: none;
    color: rgba(35, 35, 35, 0.45);
    font-family: 'Gotham', sans-serif;
    font-size: 14px;
    font-weight: 400;
    line-height: 1.5;
    transition: color 0.2s;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-breadcrumb-link:hover {
    color: rgba(35, 35, 35, 0.7);
  }

  #shopify-section-{{ section.id }} .quiz-calculating-breadcrumb-icon {
    width: 20px;
    height: 20px;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-breadcrumb-text {
    font-family: 'Gotham', sans-serif;
    font-size: 14px;
    font-weight: 400;
    line-height: 1.5;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-mobile-next {
    display: none;
    align-items: center;
    gap: 12px;
    padding: 8px 16px;
    background: #1a365d;
    border-radius: 8px;
    color: white;
    font-family: 'Gotham', sans-serif;
    font-size: 14px;
    font-weight: 400;
    text-decoration: none;
    border: none;
    cursor: pointer;
  }

  @media (max-width: 1024px) {
    #shopify-section-{{ section.id }} .quiz-calculating-mobile-next {
      display: flex;
    }
  }

  /* Progress Bar */
  #shopify-section-{{ section.id }} .quiz-calculating-progress-wrapper {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 24px;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-progress-bar {
    position: relative;
    width: 100%;
    height: 3px;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-progress-bar-track {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 3px;
    background: rgba(28, 28, 28, 0.1);
    border-radius: 999px;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-progress-bar-fill {
    position: absolute;
    top: 0;
    left: 0;
    height: 3px;
    background: #1a365d;
    border-radius: 999px;
    width: 100%;
    transition: width 0.3s ease;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-step-indicator {
    font-family: 'Gotham', sans-serif;
    font-size: 14px;
    font-weight: 400;
    line-height: 1.5;
    color: #272727;
    text-align: center;
  }

  /* Main Content */
  #shopify-section-{{ section.id }} .quiz-calculating-main-content {
    display: flex;
    flex-direction: column;
    gap: 44px;
    align-items: center;
    justify-content: flex-start;
    flex: 1;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-title {
    font-family: 'Vanilla Ravioli', sans-serif;
    font-size: 32px;
    font-weight: 400;
    line-height: 1.3;
    color: #232323;
    text-transform: capitalize;
    text-align: center;
    margin: 0;
    max-width: 474px;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-subtitle {
    font-family: 'Gotham', sans-serif;
    font-size: 18px;
    font-weight: 400;
    line-height: 1.5;
    color: #272727;
    text-align: center;
    margin: 0;
    max-width: 412px;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-button {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 16px 32px;
    height: 56px;
    background: #1a365d;
    color: #fcfefe;
    border: none;
    border-radius: 16px;
    font-family: 'Gotham', sans-serif;
    font-size: 14px;
    font-weight: 500;
    line-height: 1.5;
    cursor: pointer;
    transition: background 0.2s;
    max-width: 500px;
    width: 100%;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-button:hover {
    background: #152a4a;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-button svg {
    width: 24px;
    height: 24px;
    flex-shrink: 0;
  }

  /* Product Image */
  #shopify-section-{{ section.id }} .quiz-calculating-products {
    display: flex;
    align-items: flex-end;
    justify-content: center;
    width: 100%;
    max-width: {{ section.settings.product_image_max_width | default: 572 }}px;
    margin: 0 auto;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-product-image {
    width: 100%;
    border-radius: 18.646px;
    overflow: hidden;
    display: flex;
    align-items: flex-end;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-product-image img {
    width: 100%;
    height: auto;
    display: block;
    object-fit: contain;
    object-position: bottom;
  }

  /* Mobile Reviews */
  #shopify-section-{{ section.id }} .quiz-calculating-mobile-reviews {
    display: none;
    width: 100%;
    overflow-x: auto;
    padding: 20px 0;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-mobile-reviews::-webkit-scrollbar {
    display: none;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-mobile-reviews-container {
    display: flex;
    gap: 12px;
    padding: 0 20px;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-mobile-review-card {
    flex: 0 0 310px;
    background: white;
    border-radius: 12px;
    box-shadow: 0px 1.514px 6.055px rgba(0, 0, 0, 0.06);
    overflow: hidden;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-mobile-review-content {
    display: flex;
    flex-direction: column;
    gap: 9px;
    padding: 12px;
    align-items: center;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-mobile-review-stars {
    display: flex;
    gap: 0;
    align-items: center;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-mobile-review-text {
    font-family: 'Gotham', sans-serif;
    font-size: 12px;
    font-weight: 400;
    line-height: 1.5;
    color: rgba(29, 33, 30, 0.75);
    text-align: center;
    margin: 0;
    width: 100%;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-mobile-review-text p {
    margin: 0;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-mobile-review-author {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 3px;
    padding: 3px 9px;
    background: #f1f1f9;
    border-radius: 42px;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-mobile-review-author-name {
    font-family: 'Neue Haas Grotesk Display Pro', sans-serif;
    font-size: 9px;
    font-weight: 500;
    line-height: 1.5;
    color: #2c2926;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-mobile-review-dot {
    flex-shrink: 0;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-mobile-review-verified {
    display: flex;
    align-items: center;
    gap: 3px;
  }

  #shopify-section-{{ section.id }} .quiz-calculating-mobile-review-verified-text {
    font-family: 'Gotham', sans-serif;
    font-size: 9px;
    font-weight: 500;
    line-height: 1.5;
    color: #2c2926;
  }

  /* Mobile Styles */
  @media (min-width: 1025px) {
    #shopify-section-{{ section.id }} .quiz-calculating-reviews-column {
      display: block;
    }
  }

  @media (max-width: 1024px) {
    #shopify-section-{{ section.id }} .quiz-calculating-wrapper {
      flex-direction: column;
    }

    #shopify-section-{{ section.id }} .quiz-calculating-reviews-column {
      display: none;
    }

    #shopify-section-{{ section.id }} .quiz-calculating-content-column {
      padding: 0 20px 20px 20px;
      border-left: none;
      min-height: auto;
      gap: 24px;
    }

    #shopify-section-{{ section.id }} .quiz-calculating-breadcrumbs {
      padding: 20px 0;
    }

    #shopify-section-{{ section.id }} .quiz-calculating-progress-wrapper {
      margin-bottom: 0;
    }

    #shopify-section-{{ section.id }} .quiz-calculating-progress-bar {
      height: 2px;
    }

    #shopify-section-{{ section.id }} .quiz-calculating-progress-bar-track {
      height: 2px;
    }

    #shopify-section-{{ section.id }} .quiz-calculating-progress-bar-fill {
      height: 3px;
      top: calc(50% + 0.5px);
      transform: translateY(-50%);
    }

    #shopify-section-{{ section.id }} .quiz-calculating-step-indicator {
      display: none;
    }

    #shopify-section-{{ section.id }} .quiz-calculating-main-content {
      gap: 24px;
      padding-top: 0;
    }

    #shopify-section-{{ section.id }} .quiz-calculating-title {
      font-size: 24px;
      line-height: 1.4;
      color: #272727;
      max-width: 100%;
    }

    #shopify-section-{{ section.id }} .quiz-calculating-subtitle {
      font-size: 14px;
      max-width: 100%;
    }

    #shopify-section-{{ section.id }} .quiz-calculating-button {
      padding: 12px 24px;
      height: auto;
      border-radius: 12px;
      gap: 12px;
      max-width: 100%;
    }

    #shopify-section-{{ section.id }} .quiz-calculating-products {
      max-width: {{ section.settings.product_image_max_width_mobile | default: 339 }}px;
    }

    #shopify-section-{{ section.id }} .quiz-calculating-product-image {
      border-radius: 11px;
    }

    #shopify-section-{{ section.id }} .quiz-calculating-mobile-reviews {
      display: block;
    }
  }
</style>

<script>
  (function() {
    // Select all buttons with the data-attribute
    const viewResultsBtns = document.querySelectorAll('[data-view-results-btn]');

    // Check if any buttons were found
    if (viewResultsBtns.length > 0) {
      // Loop through each button found
      viewResultsBtns.forEach(function(btn) {
        // Add the click event listener to each one
        btn.addEventListener('click', function() {
          if (window.QuizManager) {
            window.QuizManager.showResults();
          }
        });
      });
    }

    // Update progress bar to 100% when calculating screen is shown
    function updateCalculatingProgress() {
      const calculatingSection = document.querySelector('[data-calculating]');
      if (calculatingSection && calculatingSection.style.display !== 'none') {
        const progressFill = calculatingSection.querySelector('.quiz-calculating-progress-bar-fill');
        if (progressFill) {
          progressFill.style.width = '100%';
        }
        
        // Update step indicator
        const stepIndicator = calculatingSection.querySelector('[data-step-indicator]');
        if (stepIndicator && window.QuizManager) {
          const visibleSteps = window.QuizManager.getVisibleSteps ? window.QuizManager.getVisibleSteps() : [];
          const totalSteps = visibleSteps.length || 21;
          stepIndicator.textContent = 'Question ' + totalSteps + ' of ' + totalSteps;
        }
      }
    }

    // Watch for calculating section visibility
    const observer = new MutationObserver(function(mutations) {
      mutations.forEach(function(mutation) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
          updateCalculatingProgress();
        }
      });
    });

    const calculatingSection = document.querySelector('[data-calculating]');
    if (calculatingSection) {
      observer.observe(calculatingSection, {
        attributes: true,
        attributeFilter: ['style']
      });
    }

    // Initial update
    updateCalculatingProgress();
  })();
</script>

{% schema %}
{
  "name": "Quiz Calculating",
  "class": "quiz-section",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Your answers are analyzed. Click 'See My Results' to continue"
    },
    {
      "type": "textarea",
      "id": "subtitle",
      "label": "Subtitle",
      "default": "See what others with your concern are saying about our custom formulas!"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button Text",
      "default": "See My Results"
    },
    {
      "type": "image_picker",
      "id": "product_image",
      "label": "Product Image"
    },
    {
      "type": "range",
      "id": "product_image_max_width",
      "label": "Product Image Max Width (Desktop)",
      "min": 500,
      "max": 600,
      "step": 1,
      "default": 572,
      "unit": "px",
      "info": "Maximum width of the product image on desktop"
    },
    {
      "type": "range",
      "id": "product_image_max_width_mobile",
      "label": "Product Image Max Width (Mobile)",
      "min": 300,
      "max": 400,
      "step": 1,
      "default": 339,
      "unit": "px",
      "info": "Maximum width of the product image on mobile"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "primary_color",
      "label": "Primary Color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#111827"
    },
    {
      "type": "color",
      "id": "button_color",
      "label": "Button Background Color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button Text Color",
      "default": "#ffffff"
    },
    {
      "type": "text",
      "id": "button_border_radius",
      "label": "Button Border Radius",
      "default": "5rem",
      "info": "CSS value for button border radius (e.g., 5rem, 8px, 50%)"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#f0f0ff"
    }
  ],
  "blocks": [
    {
      "type": "review",
      "name": "Review",
      "settings": [
        {
          "type": "richtext",
          "id": "review_text",
          "label": "Review Text",
          "default": "<p>I've tried everything, but this is the only formula that truly delivers results for my hair.</p>"
        },
        {
          "type": "text",
          "id": "author_name",
          "label": "Author Name",
          "default": "Sarah M."
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Quiz Calculating",
      "blocks": [
        {
          "type": "review",
          "settings": {
            "review_text": "<p>I've tried everything, but this is the only formula that truly delivers results for my hair.</p>",
            "author_name": "Sarah M."
          }
        },
        {
          "type": "review",
          "settings": {
            "review_text": "<p>Using 1,5 year the hair oil and for 1 month the liquid vitamine. These are the results</p>",
            "author_name": "Lauren P."
          }
        },
        {
          "type": "review",
          "settings": {
            "review_text": "<p>I was always struggle with growing my hair, probably last 10 years. I could not find any routine and treatment for my fine hair.</p>",
            "author_name": "Andreea B."
          }
        },
        {
          "type": "review",
          "settings": {
            "review_text": "<p>Significant reduction of shedding. But I'm still on my way to fuller hair.</p>",
            "author_name": "Alenka Čakš Č."
          }
        },
        {
          "type": "review",
          "settings": {
            "review_text": "<p>My hair has never felt healthier, fuller, and stronger it's truly transformed. Thank you afsennah!</p>",
            "author_name": "Jessica L."
          }
        }
      ]
    }
  ]
}
{% endschema %}
