{%- unless template.name == 'cart' or settings.cart_type == 'page' -%}
{%- capture announcement -%}
  {% if section.settings.show_announcement %}
    {%- liquid
      if section.settings.announcement_enable_box
        assign box_color_brightness = section.settings.announcement_box_color | color_brightness
        if box_color_brightness > 128
          assign box_color_saturation = section.settings.announcement_box_color | color_extract: 'saturation'
          if box_color_saturation > 0
            assign text_col = section.settings.announcement_box_color | color_darken: 60 | color_saturate: 30 | color_to_rgb | split: '(' | last | split: ')' | first
          else
            assign text_col = section.settings.announcement_box_color | color_darken: 60 | color_to_rgb | split: '(' | last | split: ')' | first
          endif
        else
          assign text_col = '255,255,255'
        endif
      endif
    -%}
    <div class="{% if section.settings.announcement_icon != blank or section.settings.announcement_custom_icon != blank %} with-icon{% endif %}{% if section.settings.announcement_enable_box %} text-box text-box--wide{% endif %}" {% if section.settings.announcement_enable_box %}style="--box-color: {{ section.settings.announcement_box_color }}; --box-text-color: {{ text_col }}"{% endif %}>
      {%- if section.settings.announcement_icon == blank and section.settings.announcement_custom_icon == blank -%}
        {{- section.settings.announcement_text -}}
      {%- else -%}
        {% if section.settings.announcement_custom_icon == blank %}
          {% render 'icon', icon: section.settings.announcement_icon, size: section.settings.announcement_icon_size %}
        {% else %}
          <span class="icon icon--image icon--{{ section.settings.announcement_icon_size }}">
            {%- liquid
              if section.settings.announcement_icon_size == 'large'
                assign icon_sizes = '38px'
                assign icon_widths = '38, 76'
              else
                assign icon_sizes = '16px'
                assign icon_widths = '16, 32'
              endif
              render 'image', image: section.settings.announcement_custom_icon, sizes: icon_sizes, widths: icon_widths
            -%}
          </span>
        {% endif %}
        <span class="with-icon__beside">{{ section.settings.announcement_text }}</span>
      {%- endif -%}
    </div>
  {% endif %}
{%- endcapture -%}

<script src="{{ 'cart-drawer.js' | asset_url }}" defer></script>
{%- if section.settings.show_order_note -%}
  <script src="{{ 'cart-note.js' | asset_url }}" defer="defer"></script>
{%- endif -%}

<cart-drawer class="drawer fixed top-0 right-0 flex flex-col w-full has-motion js-cart-drawer" role="dialog" tabindex="-1" aria-labelledby="CartDrawerModal-Title" aria-modal="true" aria-hidden="true" data-name="cart-drawer" data-section-id="{{ section.id }}">
  <cart-form data-section-id="{{ section.id }}" class="cart-drawer" data-ajax-update="true">
    <div class="cart-drawer__content{% if cart.items == empty %} cart-drawer__content--hidden{% endif %}" data-merge-attributes="content-container">
      <div class="cart-drawer__content-upper">
        <header class="cart-drawer__header cart-drawer__content-item">
          <div id="CartDrawerModal-Title" class="cart-drawer__title h4 heading-font" data-merge="header-title">
            {{ 'cart.general.title' | t }}

            {% if cart.items != empty %}
              <span class="title-dot"></span>
              <span class="cart-drawer__title-count">{{ cart.item_count }}</span>
            {% endif %}
          </div>

          <button type="button" class="drawer__close-btn js-close-drawer">
            <span class="visually-hidden">{{ 'accessibility.close' | t }}</span>
            {% render 'icon-close' %}
          </button>
        </header>

        {%- if section.settings.enable_tiered_rewards -%}
          <div class="cart-drawer__content-item">
            {%- render 'tiered-rewards-bar' -%}
          </div>
        {%- elsif settings.show_free_shipping_bar -%}
          <div class="cart-drawer__content-item">
            {%- render 'free-shipping-bar' -%}
          </div>
        {%- endif -%}

        {%- if section.settings.announcement_position == 'above-items' -%}
          <div class="cart-drawer__content-item">
            <div class="cart-info-block cart-info-block--lmtb">{{- announcement -}}</div>
          </div>
        {%- endif -%}

        <div class="cart-item-list cart-drawer__content-item">
          <div class="cart-item-list__body" data-merge-list="cart-items">
            {% for item in cart.items %}
              <div class="cart__line-item" data-merge-list-item="item-key:{{ item.key }}|{{ item.final_price }}{% for discount_allocation in item.line_level_discount_allocations %}|{{ discount_allocation.discount_application.title | escape }}{% endfor %}"
                  {% comment %} Discount items are difficult to predict - BOGOFs appear as a separate item with the same key as an existing item - simpler to always refresh {% endcomment %}
                  {%- if item.line_level_discount_allocations == empty -%}
                  data-merge-cache="{{ item.key }}|{{ item.quantity }}|{{ item.final_line_price }}|{% if item.selling_plan_allocation %}{{ item.selling_plan_allocation.selling_plan.id }}{% endif %}"
                  {%- endif -%}>
                {%- render 'cart-item', item: item, forloop: forloop, drawer: true -%}
              </div>
            {% endfor %}
          </div>
        </div>

        {%- if section.settings.announcement_position == 'below-items' -%}
          <div class="cart-drawer__content-item">
            <div class="cart-info-block cart-info-block--lmtb">{{- announcement -}}</div>
          </div>
        {%- endif -%}
      </div>

      <div data-merge="cross-sells" data-merge-cache="{% if cart.items == blank %}blank{% else %}{{ cart.items.first.product.id }}{% endif %}">
        {%- liquid
          if section.settings.enable_cross_sells
            if cart.items == empty
              if section.settings.cross_sell_products != blank
                assign cross_sell_product_list = true
              endif
            else
              if section.settings.enable_automatic_cross_sells
                assign cross_sell_auto = true
              elsif section.settings.cross_sell_products != blank
                assign cross_sell_product_list = true
              endif
            endif
          endif
        -%}
        {%- if cross_sell_product_list or cross_sell_auto -%}
          <div class="cart-item-upsells">
            <cc-cart-cross-sell{% if cross_sell_auto %} data-from="{{ routes.product_recommendations_url }}?section_id=mini-related-products&limit=8&product_id={{ cart.items.first.product.id }}"{% endif %}>
              <carousel-slider class="carousel block collection-slider cart-drawer__content-item use-color-scheme use-color-scheme--{{ section.settings.croll_sell_color_scheme }}" data-dispatch-events="true">
                <div class="opposing-items opposing-items--valign-base very-lightly-spaced-row">
                  <div class="opposing-items__left product-info-label">{{ section.settings.cross_sell_title | escape }}</div>
                  <div class="no-wrap slider-nav">
                    <button name="prev" class="slider-nav__btn has-ltr-icon">
                      <span class="visually-hidden">{{ 'general.slider.previous' | t }}</span>
                      {% render 'icon-chevron-left' %}
                    </button>
                    <button name="next" class="slider-nav__btn has-ltr-icon">
                      <span class="visually-hidden">{{ 'general.slider.next' | t }}</span>
                      {% render 'icon-chevron-right' %}
                    </button>
                  </div>
                </div>
                <div class="slider slider--no-scrollbar slider--edge-peek">
                  <ul class="slider__grid product-grid product-grid--carousel product-grid--per-row-3 product-grid--per-row-mob-3">
                    {%- if cross_sell_product_list -%}
                      {%- liquid
                        if settings.prod_thumb_shape == 'portrait-23'
                          assign chosen_aspect_ratio = 0.67
                        elsif settings.prod_thumb_shape == 'portrait-45'
                          assign chosen_aspect_ratio = 0.8
                        elsif settings.prod_thumb_shape == 'square'
                          assign chosen_aspect_ratio = 1.0
                        elsif settings.prod_thumb_shape == 'landscape-54'
                          assign chosen_aspect_ratio = 1.25
                        elsif settings.prod_thumb_shape == 'landscape-32'
                          assign chosen_aspect_ratio = 1.50
                        elsif settings.prod_thumb_shape == 'tallest'
                          assign chosen_aspect_ratio = 99
                          for product in section.settings.cross_sell_products
                            if product.featured_media.preview_image.aspect_ratio < chosen_aspect_ratio
                              assign chosen_aspect_ratio = product.featured_media.preview_image.aspect_ratio
                            endif
                          endfor
                        else
                          assign chosen_aspect_ratio = 0
                          for product in section.settings.cross_sell_products
                            if product.featured_media.preview_image.aspect_ratio > chosen_aspect_ratio
                              assign chosen_aspect_ratio = product.featured_media.preview_image.aspect_ratio
                            endif
                          endfor
                        endif
                      -%}

                      {%- for product in section.settings.cross_sell_products -%}
                        <li class="slider__item">
                          {%- render 'product-block', product: product, manual_loading: true, no_quick_buy: false, no_swiping: true, custom_aspect_ratio: chosen_aspect_ratio -%}
                        </li>
                      {%- endfor -%}
                    {%- endif -%}
                  </ul>
                </div>
                <div class="cart-item-upsells__dots"></div>
              </carousel-slider>
            </cc-cart-cross-sell>
          </div>
        {%- endif -%}
      </div>
    </div>

    <style>
      /* Custom styles for cart-item-upsells slider */
      .cart-item-upsells .product-grid--carousel {
        --product-columns-desktop: 2.65;
        grid-auto-columns: calc((100% - var(--gutter) * 1.65) / 2.65);
      }

      .cart-item-upsells .product-grid--carousel .slider__item {
        display: flex;
        flex-direction: column;
      }

      .cart-item-upsells .product-grid--carousel .product-block {
        display: flex;
        flex-direction: column;
        flex-grow: 1;
      }

      .cart-item-upsells .product-grid--carousel .block-inner {
        flex-grow: 1;
      }

      /* Mobile styles - keep original behavior */
      @media (max-width: 767.98px) {
        .cart-item-upsells .product-grid--carousel {
          --product-columns-desktop: 1.5;
          grid-auto-columns: calc((100% - var(--gutter) * 0.5) / 1.5);
        }
      }

      /* Dots styles */
      .cart-item-upsells__dots {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 8px;
        margin-top: 16px;
        padding: 0 16px;
      }

      .cart-item-upsells__dot {
        width: 40px;
        height: 4px;
        border-radius: 42px;
        background: rgba(12, 28, 37, 0.1);
        border: none;
        cursor: pointer;
        padding: 0;
        transition: all 0.3s ease;
        flex-shrink: 0;
      }

      .cart-item-upsells__dot.active {
        background: #0C1C25;
      }

      .cart-item-upsells .opposing-items {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .cart-item-upsells .opposing-items__left {
        flex: 1;
      }

      .cart-item-upsells .slider-nav {
        display: flex;
        gap: 8px;
        margin-left: auto;
      }
    </style>

    <script>
      (function() {
        let isInitialized = false;
        let cleanupFn = null;

        function initCartUpsellsDots() {
          // Prevent multiple initializations
          if (isInitialized) return;

          const cartUpsells = document.querySelector('.cart-item-upsells');
          if (!cartUpsells) return;

          const carousel = cartUpsells.querySelector('carousel-slider');
          if (!carousel || !carousel.hasAttribute('loaded')) {
            // Wait for carousel to initialize
            setTimeout(initCartUpsellsDots, 100);
            return;
          }

          // Check if already initialized for this carousel
          if (carousel.dataset.dotsInitialized === 'true') return;

          const dotsContainer = cartUpsells.querySelector('.cart-item-upsells__dots');
          if (!dotsContainer) return;

          const slider = carousel.querySelector('.slider');
          const slides = carousel.querySelectorAll('.slider__item:not([hidden])');
          
          if (slides.length < 2) {
            dotsContainer.style.display = 'none';
            return;
          }

          dotsContainer.style.display = 'flex';
          carousel.dataset.dotsInitialized = 'true';

          // Wait for carousel to be fully initialized and get its properties
          function getCarouselInfo() {
            const grid = carousel.querySelector('.slider__grid');
            if (!grid) return null;

            const gridWidth = grid.clientWidth;
            if (gridWidth === 0) return null;

            const firstSlide = slides[0];
            const secondSlide = slides[1];
            if (!firstSlide || !secondSlide) return null;

            const firstRect = firstSlide.getBoundingClientRect();
            const secondRect = secondSlide.getBoundingClientRect();
            const slideSpan = secondRect.left - firstRect.left;
            
            if (slideSpan <= 0) return null;

            // Check if mobile or desktop based on grid classes
            const isMobile = window.innerWidth < 768;
            
            // Calculate visible slides per page
            // Desktop: 2.8 slides (2 full + 1 at 80%), Mobile: 1.5 slides (partial view)
            let slidesPerPage;
            let totalPages;
            
            if (isMobile) {
              // Mobile: 1.5 slides visible (calculate based on actual width)
              slidesPerPage = (gridWidth + (slideSpan - firstSlide.clientWidth)) / slideSpan;
              // For mobile with 1.5 slides per view: totalPages = slides.length
              // Each slide can be a starting point (showing 1 full + 0.5 next)
              totalPages = Math.max(1, slides.length);
            } else {
              // Desktop: 2.65 slides per page (2 full + 1 at 65%)
              slidesPerPage = 2.65;
              // For desktop: calculate pages based on 2.65 slides per page
              // Each page shows 2 full slides + 0.65 of next, so we scroll by 2 slides per page
              // Pages start at indices: 0, 2, 4, 6, etc.
              if (slides.length <= 2) {
                totalPages = 1;
              } else {
                // For 7 slides: pages at 0, 2, 4 = 3 pages (showing 0-1.65, 2-3.65, 4-5.65, and last shows 6)
                totalPages = Math.ceil((slides.length - 2) / 2) + 1;
              }
            }

            return { slidesPerPage, totalPages, slideSpan, isMobile };
          }

          let carouselInfo = getCarouselInfo();
          if (!carouselInfo) {
            setTimeout(() => {
              carouselInfo = getCarouselInfo();
              if (carouselInfo) initDots();
            }, 200);
            return;
          }

          let { slidesPerPage, totalPages, slideSpan, isMobile } = carouselInfo;
          let currentPage = 0;

          // Debounce helper
          function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
              const later = () => {
                clearTimeout(timeout);
                func(...args);
              };
              clearTimeout(timeout);
              timeout = setTimeout(later, wait);
            };
          }

          // Create dots
          function createDots() {
            dotsContainer.innerHTML = '';
            if (totalPages <= 1) {
              dotsContainer.style.display = 'none';
              return;
            }
            dotsContainer.style.display = 'flex';
            
            for (let i = 0; i < totalPages; i++) {
              const dot = document.createElement('button');
              dot.className = 'cart-item-upsells__dot';
              if (i === 0) dot.classList.add('active');
              dot.setAttribute('aria-label', `Go to page ${i + 1}`);
              dot.dataset.pageIndex = i;
              dot.addEventListener('click', (e) => {
                const pageIndex = parseInt(e.currentTarget.dataset.pageIndex);
                goToPage(pageIndex);
              });
              dotsContainer.appendChild(dot);
            }
          }

          // Go to specific page
          function goToPage(pageIndex) {
            if (pageIndex < 0 || pageIndex >= totalPages) return;
            
            // Calculate which slide index corresponds to this page
            // For mobile (1.5 slides): page 0 = slide 0, page 1 = slide 1, etc.
            // For desktop (2.65 slides): page 0 = slide 0, page 1 = slide 2, etc.
            let targetSlideIndex;
            if (isMobile) {
              // Mobile: each page shows 1.5 slides, so we scroll by 1 slide per page
              targetSlideIndex = Math.min(pageIndex, slides.length - 1);
            } else {
              // Desktop: each page shows 2.65 slides (2 full + 0.65)
              // We scroll by 2 slides per page to show: 2 full + next at 65%
              // Each page starts at slide index: 0, 2, 4, 6, etc.
              targetSlideIndex = pageIndex * 2;
              
              // For last page, ensure we don't go beyond available slides
              // If calculated index would be too high, use the pattern: last page shows last 2-3 slides
              if (pageIndex === totalPages - 1) {
                // Last page should show the last slides that fit the pattern
                // Ensure we show at least 2 slides, so max index is slides.length - 2
                const maxIndex = Math.max(0, slides.length - 2);
                // But keep it aligned to the pattern (even numbers: 0, 2, 4, 6...)
                if (targetSlideIndex > maxIndex) {
                  // Find the highest even index that shows last 2-3 slides
                  targetSlideIndex = Math.max(0, Math.floor((slides.length - 2) / 2) * 2);
                }
              }
              
              // Final safety check
              targetSlideIndex = Math.min(targetSlideIndex, slides.length - 1);
            }
            
            const targetSlide = slides[targetSlideIndex];
            if (!targetSlide) return;

            // Use carousel's scrollToElement method if available
            if (typeof carousel.scrollToElement === 'function') {
              carousel.scrollToElement(targetSlide, 'smooth');
            } else {
              // Fallback: direct scroll
              const targetScroll = targetSlide.offsetLeft;
              slider.scrollTo({
                left: targetScroll,
                behavior: 'smooth'
              });
            }
            
            // Manually update dots after a short delay to ensure scroll completes
            setTimeout(() => {
              const currentIndex = Math.round(Math.abs(slider.scrollLeft) / slideSpan) || 0;
              updateDotsFromIndex(currentIndex);
            }, 150);
          }

          // Update dots based on current slide index
          function updateDotsFromIndex(slideIndex) {
            let newPage;
            if (isMobile) {
              // Mobile: each page corresponds to one slide (with 1.5 visible)
              newPage = Math.min(slideIndex, totalPages - 1);
            } else {
              // Desktop: 2.65 slides per page (2 full + 0.65)
              // Pages are: 0 (slides 0-1.65), 1 (slides 2-3.65), 2 (slides 4-5.65), etc.
              // Each page starts at even slide index: 0, 2, 4, 6, etc.
              
              // Check if we're at the end of the slider
              const maxScrollLeft = slider.scrollWidth - slider.clientWidth;
              const isAtEnd = Math.abs(slider.scrollLeft - maxScrollLeft) < 10; // 10px tolerance
              
              // Check if we're in the last page
              // Last page shows slides starting from (totalPages - 1) * 2
              const lastPageStartIndex = (totalPages - 1) * 2;
              
              if (isAtEnd || slideIndex >= lastPageStartIndex || slideIndex >= slides.length - 2) {
                // We're in the last page (either by index or by scroll position)
                newPage = totalPages - 1;
              } else {
                // Calculate page based on slide index: page = floor(slideIndex / 2)
                newPage = Math.floor(slideIndex / 2);
                // Ensure we don't exceed total pages
                newPage = Math.min(newPage, totalPages - 1);
              }
            }
            
            // Always update if page changed, even if it's the same to ensure UI is correct
            if (newPage >= 0 && newPage < totalPages) {
              currentPage = newPage;
              const dots = dotsContainer.querySelectorAll('.cart-item-upsells__dot');
              dots.forEach((dot, idx) => {
                dot.classList.toggle('active', idx === currentPage);
              });
            }
          }

          // Listen to carousel select events
          const selectHandler = (e) => {
            const slideIndex = e.detail.index;
            updateDotsFromIndex(slideIndex);
          };
          
          carousel.addEventListener('on:carousel-slider:select', selectHandler);
          
          // Also listen to scroll events to catch cases where select event doesn't fire
          const scrollHandler = debounce(() => {
            // Calculate current slide index based on scroll position
            const currentIndex = Math.round(Math.abs(slider.scrollLeft) / slideSpan) || 0;
            // Also check if we're at the end
            const maxScrollLeft = slider.scrollWidth - slider.clientWidth;
            const isAtEnd = Math.abs(slider.scrollLeft - maxScrollLeft) < 10;
            
            // If at end, use last slide index to ensure last page is detected
            const slideIndexToUse = isAtEnd ? Math.max(currentIndex, slides.length - 1) : currentIndex;
            updateDotsFromIndex(slideIndexToUse);
          }, 150);
          
          slider.addEventListener('scroll', scrollHandler);

          // Initialize dots
          function initDots() {
            carouselInfo = getCarouselInfo();
            if (!carouselInfo) return;
            
            slidesPerPage = carouselInfo.slidesPerPage;
            totalPages = carouselInfo.totalPages;
            slideSpan = carouselInfo.slideSpan;
            isMobile = carouselInfo.isMobile;
            
            createDots();
            
            // Set initial active dot based on current scroll position
            const currentIndex = Math.round(Math.abs(slider.scrollLeft) / slideSpan) || 0;
            updateDotsFromIndex(currentIndex);
          }

          // Recalculate on resize
          let resizeTimeout;
          const resizeHandler = () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
              carouselInfo = getCarouselInfo();
              if (carouselInfo) {
                slidesPerPage = carouselInfo.slidesPerPage;
                totalPages = carouselInfo.totalPages;
                slideSpan = carouselInfo.slideSpan;
                isMobile = carouselInfo.isMobile;
                createDots();
                const currentIndex = Math.round(Math.abs(slider.scrollLeft) / slideSpan) || 0;
                updateDotsFromIndex(currentIndex);
              }
            }, 250);
          };
          
          window.addEventListener('resize', resizeHandler);

          // Initial setup
          initDots();
          isInitialized = true;

          // Cleanup function
          cleanupFn = () => {
            carousel.removeEventListener('on:carousel-slider:select', selectHandler);
            slider.removeEventListener('scroll', scrollHandler);
            window.removeEventListener('resize', resizeHandler);
            carousel.dataset.dotsInitialized = 'false';
            isInitialized = false;
          };
        }

        // Initialize when DOM is ready
        function startInit() {
          setTimeout(() => {
            if (!isInitialized) {
              initCartUpsellsDots();
            }
          }, 300);
        }

        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', startInit);
        } else {
          startInit();
        }

        // Re-initialize when cart drawer opens or content updates
        document.addEventListener('DOMContentLoaded', () => {
          const cartDrawer = document.querySelector('cart-drawer');
          if (cartDrawer) {
            // Reset on drawer open
            const observer = new MutationObserver((mutations) => {
              const shouldReset = mutations.some(mutation => {
                return Array.from(mutation.addedNodes).some(node => 
                  node.nodeType === 1 && 
                  (node.classList?.contains('cart-item-upsells') || 
                   node.querySelector?.('.cart-item-upsells'))
                );
              });
              
              if (shouldReset && cleanupFn) {
                cleanupFn();
                cleanupFn = null;
                setTimeout(() => {
                  if (!isInitialized) {
                    initCartUpsellsDots();
                  }
                }, 400);
              }
            });
            
            observer.observe(cartDrawer, { 
              childList: true, 
              subtree: true 
            });
          }
        });
      })();
    </script>

    <div class="cart-drawer__footer{% if cart.items == empty %} cart-drawer__footer--hidden{% endif %}" data-merge-attributes="footer-container">
      {%- if section.settings.announcement_position == 'above-subtotal' -%}
        <div class="cart-info-block cart-info-block--smb">{{- announcement -}}</div>
      {%- endif -%}

      <div data-merge="footer">
        {% if cart.items != empty %}
          {%- if cart.cart_level_discount_applications != blank -%}
            <ul class="cart-discount-list">
              {%- for discount_application in cart.cart_level_discount_applications -%}
                <li class="cart-discount cart-discount--inline">
                  <span class="cart-discount__label">
                      <span class="cart-discount__icon">{% render 'icon-label' %}</span>
                      <span class="cart-discount__title">{{ discount_application.title }}</span>
                  </span>
                  <span class="cart-discount__amount theme-money">{{ discount_application.total_allocated_amount | money }}</span>
                </li>
              {%- endfor -%}
            </ul>
          {%- endif -%}
          <div class="subtotal h4 heading-font opposing-items">
            {{ 'cart.summary.subtotal' | t }}:
            <span class="theme-money">
              {%- if settings.cart_currency_code_enabled -%}
                {{- cart.total_price | money_with_currency -}}
              {%- else -%}
                {{- cart.total_price | money -}}
              {%- endif -%}
            </span>
          </div>

          <div class="lightly-spaced-row">
            {%- if section.settings.show_tax_and_shipping -%}
              <div class="cart-policies rte">
                {%- if cart.taxes_included and shop.shipping_policy.body != blank -%}
                  {{- 'cart.general.taxes_included_shipping_at_checkout_html' | t: link: shop.shipping_policy.url -}}
                {%- elsif cart.taxes_included -%}
                  {{- 'cart.general.taxes_included_shipping_at_checkout' | t -}}
                {%- elsif shop.shipping_policy.body != blank -%}
                  {{- 'cart.general.taxes_and_shipping_at_checkout_html' | t: link: shop.shipping_policy.url -}}
                {%- else -%}
                  {{- 'cart.general.taxes_and_shipping_at_checkout' | t -}}
                {%- endif -%}
              </div>
            {%- endif -%}

            {% if section.settings.show_order_note %}
              <toggle-target id="CartDrawerNoteToggle" role="button" tabindex="0" class="toggle-target-toggler--is-hidden link underline" data-toggle-target=".cart-drawer__note">{{ 'cart.note.label' | t }}</toggle-target>
              <div class="cart-drawer__note toggle-target toggle-target--hidden">
                <cart-note class="block toggle-target-container">
                  <textarea name="note" aria-labelledby="CartDrawerNoteToggle">{{ cart.note }}</textarea>
                </cart-note>
              </div>
            {% endif %}
          </div>
        {% endif %}
      </div>

      {% if section.settings.cart_terms_page != blank %}
        <terms-agreement class="terms-agreement rte">
          <input type="checkbox" id="terms" />
          <label for="terms">{{ 'cart.terms.agreement_html' | t: terms_url: section.settings.cart_terms_page }}</label>
        </terms-agreement>
      {% endif %}

      <div class="checkout-buttons{% if cart.items == empty %} hidden{% endif %}" data-merge-attributes="checkout-buttons">
        {% if section.settings.enable_direct_cart %}
          <a href="{{ routes.root_url | append: '/checkout' | replace: '//', '/' }}" class="btn btn--large btn--wide">{{ 'cart.summary.checkout' | t }}</a>
        {% else %}
          <a href="{{ routes.cart_url }}" class="btn btn--large btn--wide">{{ 'cart.summary.checkout' | t }}</a>
        {% endif %}
      </div>

      {%- if section.settings.announcement_position == 'below-checkout' -%}
        <div class="cart-info-block cart-info-block--smt">{{- announcement -}}</div>
      {%- endif -%}
    </div>

    <div
      class="cart-drawer__empty-content{% if section.settings.empty_enable_custom_colors %} cart-drawer__empty-content--custom-colors{% endif %}{% if cart.items != empty %} cart-drawer__empty-content--hidden{% endif %}"
      data-merge-attributes="empty-container"
      {% if section.settings.empty_enable_custom_colors %}
        style="--bg: {{ section.settings.empty_color_background_gradient | default: section.settings.empty_color_background }};
              --text-color: {{ section.settings.empty_color_text.rgb }}"
      {% endif %}>
      <button type="button" class="drawer__close-btn js-close-drawer">
        <span class="visually-hidden">{{ 'accessibility.close' | t }}</span>
        {% render 'icon-close' %}
      </button>
      <div class="align-center">
        {%- if section.settings.empty_icon == 'basket' -%}
          <div class="lightly-spaced-row"><span class="icon--large">{%- render 'icon-basket' -%}</span></div>
        {%- elsif section.settings.empty_icon == 'bag' -%}
          <div class="lightly-spaced-row"><span class="icon--large">{%- render 'icon-bag' -%}</span></div>
        {%- elsif section.settings.empty_icon == 'cart' -%}
          <div class="lightly-spaced-row"><span class="icon--large">{%- render 'icon-cart' -%}</span></div>
        {%- endif -%}

        {%- if section.settings.empty_heading != blank -%}
          <div class="majortitle h1">{{ section.settings.empty_heading }}</div>
        {%- endif -%}

        {%- if section.settings.empty_text != blank -%}
          <div class="rte">{{ section.settings.empty_text }}</div>
        {%- endif -%}

        {%- if section.settings.empty_button_text != blank -%}
          <div class="button-row">
            <a class="{% if section.settings.empty_button_style != 'link' %}btn btn--{{ section.settings.empty_button_style }}{% else %}small-feature-link{% endif %} button-row__btn" href="{{ section.settings.empty_button_link }}">{{ section.settings.empty_button_text | escape }}</a>
          </div>
        {%- endif -%}
      </div>
    </div>
  </cart-form>
</cart-drawer>
{%- endunless -%}


{% schema %}
{
  "name": "Cart drawer",
  "class": "section-cart-drawer",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_order_note",
      "label": "Show order note",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_tax_and_shipping",
      "label": "Show tax status and shipping policy link",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_direct_cart",
      "label": "Enable direct checkout",
      "info": "Disable to send customers to the cart page",
      "default": true
    },
    {
      "type": "url",
      "id": "cart_terms_page",
      "label": "Terms and Conditions link",
      "info": "Checkbox only required if direct checkout is enabled"
    },
    {
      "type": "checkbox",
      "id": "show_backorder_text",
      "label": "Show backorder text",
      "default": false,
      "info": "Only shows for products which use inventory tracking and are available to purchase when out of stock."
    },
    {
      "type": "header",
      "content": "Inventory notice"
    },
    {
      "type": "select",
      "id": "show_inventory_notice",
      "label": "Show inventory notice",
      "options": [
        {
          "label": "Never",
          "value": "never"
        },
        {
          "label": "When inventory low",
          "value": "low"
        },
        {
          "label": "Always",
          "value": "always"
        }
      ],
      "default": "low"
    },
    {
      "type": "select",
      "id": "show_inventory_count",
      "label": "Show count in inventory notice",
      "options": [
        {
          "label": "Never",
          "value": "never"
        },
        {
          "label": "When inventory low",
          "value": "low"
        },
        {
          "label": "Always",
          "value": "always"
        }
      ],
      "default": "low"
    },
    {
      "type": "range",
      "id": "inventory_threshold",
      "min": 1,
      "max": 100,
      "step": 1,
      "label": "Low inventory threshold",
      "default": 10
    },
    {
      "type": "header",
      "content": "Tiered Rewards Bar"
    },
    {
      "type": "checkbox",
      "id": "enable_tiered_rewards",
      "label": "Enable tiered rewards bar",
      "default": true
    },
    {
      "visible_if": "{{ section.settings.enable_tiered_rewards }}",
      "type": "number",
      "id": "free_shipping_threshold",
      "label": "Free shipping threshold ($)",
      "default": 100,
      "info": "Amount in dollars (e.g., 100 for $100)"
    },
    {
      "type": "text",
      "id": "free_shipping_label",
      "label": "Free shipping label",
      "default": "Free shipping"
    },
    {
      "type": "text",
      "id": "description_subscription",
      "label": "Description for subscription in Line item",
      "default": "Easily Edit, Delay, Pause, and Cancel Anytime"
    },
    {
      "visible_if": "{{ section.settings.enable_tiered_rewards }}",
      "type": "header",
      "content": "Banner Settings"
    },
    {
      "visible_if": "{{ section.settings.enable_tiered_rewards }}",
      "type": "select",
      "id": "banner_icon",
      "label": "Banner icon",
      "default": "gift",
      "options": [
        {
          "value": "",
          "label": "No icon"
        },
        {
          "value": "gift",
          "label": "Gift"
        },
        {
          "value": "award",
          "label": "Award"
        },
        {
          "value": "star",
          "label": "Star"
        }
      ]
    },
    {
      "visible_if": "{{ section.settings.enable_tiered_rewards }}",
      "type": "image_picker",
      "id": "banner_custom_icon",
      "label": "Banner custom icon"
    },
    {
      "visible_if": "{{ section.settings.enable_tiered_rewards }}",
      "type": "text",
      "id": "banner_text",
      "label": "Banner text (before achievement)",
      "default": "Spend [AMOUNT] more to get Free [LABEL]!",
      "info": "Use [AMOUNT] for amount and [LABEL] for next tier label"
    },
    {
      "visible_if": "{{ section.settings.enable_tiered_rewards }}",
      "type": "text",
      "id": "banner_text_achieved",
      "label": "Banner text (after free shipping)",
      "default": "Free shipping added! Spend [AMOUNT] more to get Free [LABEL]!",
      "info": "Use [AMOUNT] for amount and [LABEL] for next tier label"
    },
    {
      "visible_if": "{{ section.settings.enable_tiered_rewards }}",
      "type": "text",
      "id": "banner_text_all_achieved",
      "label": "Banner text (all achieved)",
      "default": "All rewards unlocked!"
    },
    {
      "visible_if": "{{ section.settings.enable_tiered_rewards }}",
      "type": "header",
      "content": "Gift Tier 1"
    },
    {
      "visible_if": "{{ section.settings.enable_tiered_rewards }}",
      "type": "number",
      "id": "gift_tier_1_amount",
      "label": "Gift tier 1 threshold ($)",
      "default": 150,
      "info": "Amount in dollars"
    },
    {
      "visible_if": "{{ section.settings.enable_tiered_rewards }}",
      "type": "text",
      "id": "gift_tier_1_label",
      "label": "Gift tier 1 label",
      "default": "Mulberry Silk"
    },
    {
      "visible_if": "{{ section.settings.enable_tiered_rewards }}",
      "type": "image_picker",
      "id": "gift_tier_1_image",
      "label": "Gift tier 1 image"
    },
    {
      "visible_if": "{{ section.settings.enable_tiered_rewards }}",
      "type": "header",
      "content": "Gift Tier 2"
    },
    {
      "visible_if": "{{ section.settings.enable_tiered_rewards }}",
      "type": "number",
      "id": "gift_tier_2_amount",
      "label": "Gift tier 2 threshold ($)",
      "default": 200,
      "info": "Amount in dollars"
    },
    {
      "visible_if": "{{ section.settings.enable_tiered_rewards }}",
      "type": "text",
      "id": "gift_tier_2_label",
      "label": "Gift tier 2 label",
      "default": "Hair Growth oil (50ml)"
    },
    {
      "visible_if": "{{ section.settings.enable_tiered_rewards }}",
      "type": "image_picker",
      "id": "gift_tier_2_image",
      "label": "Gift tier 2 image"
    },
    {
      "visible_if": "{{ section.settings.enable_tiered_rewards }}",
      "type": "header",
      "content": "Gift Tier 3"
    },
    {
      "visible_if": "{{ section.settings.enable_tiered_rewards }}",
      "type": "number",
      "id": "gift_tier_3_amount",
      "label": "Gift tier 3 threshold ($)",
      "default": 250,
      "info": "Amount in dollars"
    },
    {
      "visible_if": "{{ section.settings.enable_tiered_rewards }}",
      "type": "text",
      "id": "gift_tier_3_label",
      "label": "Gift tier 3 label",
      "default": "Microneedle Scalp Roller"
    },
    {
      "visible_if": "{{ section.settings.enable_tiered_rewards }}",
      "type": "image_picker",
      "id": "gift_tier_3_image",
      "label": "Gift tier 3 image"
    },
    {
      "type": "header",
      "content": "Announcement"
    },
    {
      "type": "checkbox",
      "id": "show_announcement",
      "label": "Show announcement",
      "default": false
    },
    {
      "visible_if": "{{ section.settings.show_announcement }}",
      "type": "select",
      "id": "announcement_position",
      "label": "Position",
      "options": [
        {
          "label": "Above cart items",
          "value": "above-items"
        },
        {
          "label": "Below cart items",
          "value": "below-items"
        },
        {
          "label": "Above subtotal",
          "value": "above-subtotal"
        },
        {
          "label": "Below checkout button",
          "value": "below-checkout"
        }
      ],
      "default": "above-items"
    },
    {
      "visible_if": "{{ section.settings.show_announcement }}",
      "type": "inline_richtext",
      "id": "announcement_text",
      "label": "Text",
      "default": "Cart announcement text"
    },
    {
      "visible_if": "{{ section.settings.show_announcement }}",
      "type": "select",
      "id": "announcement_icon",
      "label": "Icon",
      "default": "box",
      "options": [
        {
          "value": "",
          "label": "No icon"
        },
        {
          "value": "accessible",
          "label": "Accessible"
        },
        {
          "value": "award",
          "label": "Award"
        },
        {
          "value": "beach",
          "label": "Beach"
        },
        {
          "value": "box",
          "label": "Box"
        },
        {
          "value": "briefcase",
          "label": "Briefcase"
        },
        {
          "value": "calendar",
          "label": "Calendar"
        },
        {
          "value": "chat_bubble",
          "label": "Chat bubble"
        },
        {
          "value": "check_mark",
          "label": "Check mark"
        },
        {
          "value": "check_mark_in_circle",
          "label": "Check mark in circle"
        },
        {
          "value": "clock",
          "label": "Clock"
        },
        {
          "value": "credit_card",
          "label": "Credit card"
        },
        {
          "value": "dollar_sign",
          "label": "Dollar sign"
        },
        {
          "value": "dryer",
          "label": "Dryer"
        },
        {
          "value": "eye",
          "label": "Eye"
        },
        {
          "value": "feather",
          "label": "Feather"
        },
        {
          "value": "gift",
          "label": "Gift"
        },
        {
          "value": "heart",
          "label": "Heart"
        },
        {
          "value": "iron",
          "label": "Iron"
        },
        {
          "value": "leaf",
          "label": "Leaf"
        },
        {
          "value": "leather",
          "label": "Leather"
        },
        {
          "value": "lock",
          "label": "Lock"
        },
        {
          "value": "map_pin",
          "label": "Map pin"
        },
        {
          "value": "pants",
          "label": "Pants"
        },
        {
          "value": "percent",
          "label": "Percent"
        },
        {
          "value": "plane",
          "label": "Plane"
        },
        {
          "value": "price_tag",
          "label": "Price tag"
        },
        {
          "value": "question_mark",
          "label": "Question mark"
        },
        {
          "value": "recycle",
          "label": "Recycle"
        },
        {
          "value": "return",
          "label": "Return"
        },
        {
          "value": "ruler",
          "label": "Ruler"
        },
        {
          "value": "scissors",
          "label": "Scissors"
        },
        {
          "value": "shirt",
          "label": "Shirt"
        },
        {
          "value": "shoe",
          "label": "Shoe"
        },
        {
          "value": "silhouette",
          "label": "Silhouette"
        },
        {
          "value": "star",
          "label": "Star"
        },
        {
          "value": "sun-high",
          "label": "Sun"
        },
        {
          "value": "truck",
          "label": "Truck"
        },
        {
          "value": "washing",
          "label": "Washing"
        },
        {
          "value": "world",
          "label": "World"
        }
      ]
    },
    {
      "visible_if": "{{ section.settings.show_announcement }}",
      "type": "image_picker",
      "id": "announcement_custom_icon",
      "label": "Custom icon"
    },
    {
      "visible_if": "{{ section.settings.show_announcement }}",
      "type": "select",
      "id": "announcement_icon_size",
      "label": "Icon size",
      "default": "small",
      "options": [
        {
          "value": "small",
          "label": "Small"
        },
        {
          "value": "large",
          "label": "Large"
        }
      ]
    },
    {
      "visible_if": "{{ section.settings.show_announcement }}",
      "type": "checkbox",
      "id": "announcement_enable_box",
      "label": "Enable box style",
      "default": true
    },
    {
      "visible_if": "{{ section.settings.show_announcement and section.settings.announcement_enable_box }}",
      "type": "color",
      "id": "announcement_box_color",
      "label": "Box color",
      "info": "Suggestions: Blue #e5f3ff, Teal #e0f5f5, Green #e0f4d5, Yellow #fcf1cd, Red #fbeae5",
      "default": "#e0f4d5"
    },
    {
      "type": "header",
      "content": "Empty cart"
    },
    {
      "type": "select",
      "id": "empty_icon",
      "label": "Icon",
      "default": "basket",
      "options": [
        {
          "value": "none",
          "label": "None"
        },
        {
          "value": "bag",
          "label": "Bag"
        },
        {
          "value": "basket",
          "label": "Basket"
        },
        {
          "value": "cart",
          "label": "Cart"
        }
      ]
    },
    {
      "type": "text",
      "id": "empty_heading",
      "label": "Heading",
      "default": "Your cart is empty"
    },
    {
      "type": "richtext",
      "id": "empty_text",
      "label": "Text"
    },
    {
      "type": "text",
      "id": "empty_button_text",
      "label": "Button text",
      "default": "Start shopping"
    },
    {
      "type": "url",
      "id": "empty_button_link",
      "label": "Button link",
      "default": "/collections/all"
    },
    {
      "type": "select",
      "id": "empty_button_style",
      "label": "Button style",
      "default": "primary",
      "options": [
        {
          "label": "Primary",
          "value": "primary"
        },
        {
          "label": "Secondary",
          "value": "secondary"
        },
        {
          "label": "Link",
          "value": "link"
        }
      ]
    },
    {
      "type": "checkbox",
      "id": "empty_enable_custom_colors",
      "label": "Enable custom colors",
      "default": false
    },
    {
      "visible_if": "{{ section.settings.empty_enable_custom_colors }}",
      "type": "color",
      "id": "empty_color_background",
      "label": "Background"
    },
    {
      "visible_if": "{{ section.settings.empty_enable_custom_colors }}",
      "type": "color_background",
      "id": "empty_color_background_gradient",
      "label": "Background gradient"
    },
    {
      "visible_if": "{{ section.settings.empty_enable_custom_colors }}",
      "type": "color",
      "id": "empty_color_text",
      "label": "Text"
    },
    {
      "type": "header",
      "content": "Recommended products"
    },
    {
      "type": "checkbox",
      "id": "enable_cross_sells",
      "label": "Show recommended products",
      "default": true
    },
    {
      "type": "text",
      "id": "cross_sell_title",
      "label": "Heading",
      "default": "You may like"
    },
    {
      "type": "product_list",
      "id": "cross_sell_products",
      "label": "Products"
    },
    {
      "type": "checkbox",
      "id": "enable_automatic_cross_sells",
      "label": "Enable automatic recommendations",
      "info": "Displays products related to the first item in the cart, replacing the recommended products above.",
      "default": true
    },
    {
      "type": "paragraph",
      "content": "Dynamic recommendations change and improve with time. [Learn more](https://help.shopify.com/en/themes/development/recommended-products)"
    },
    {
      "type": "select",
      "id": "croll_sell_color_scheme",
      "label": "Color scheme",
      "default": "1",
      "options": [
        {
          "value": "default",
          "label": "Default"
        },
        {
          "value": "1",
          "label": "1"
        },
        {
          "value": "2",
          "label": "2"
        }
      ]
    }
  ]
}
{% endschema %}
