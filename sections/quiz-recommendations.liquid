{% comment %}
  Quiz Recommendations Section for Shopify
  Shows recommended products based on quiz answers with Seal Subscriptions support
{% endcomment %}

{{ 'quiz-section.css' | asset_url | stylesheet_tag }}

{%- style -%}
    .quiz-recommendations-{{ section.id }} {
    --primary-color: {{ section.settings.primary_color }};
    --text-color: {{ section.settings.text_color }};
    --highlight-color: {{ section.settings.highlight_color }};
    --button-color: {{ section.settings.button_color }};
    --button-text-color: {{ section.settings.button_text_color }};
    --btn-border-radius: {{ section.settings.button_border_radius }};
    --remove-button-color: {{ section.settings.remove_button_color }};
    --remove-button-text-color: {{ section.settings.remove_button_text_color }};
    --checkout-button-color: {{ section.settings.checkout_button_color }};
    --checkout-button-text-color: {{ section.settings.checkout_button_text_color }};
    }

    #shopify-section-{{ section.id }}.quiz-section {
    background: {{ section.settings.background_color }};
    }

    #shopify-section-{{ section.id }}{
        padding: 0;
    }
{%- endstyle -%}

<div class="quiz-recommendations quiz-section quiz-recommendations-{{ section.id }}" data-recommendations style="display: none;" data-product-sort-order="{% if section.settings.product_sort_order != blank %}{{ section.settings.product_sort_order | map: 'handle' | join: ',' }}{% endif %}" data-bogo-enabled="{{ section.settings.bogo_enabled }}" data-bogo-products="{% if section.settings.bogo_products != blank %}{{ section.settings.bogo_products | map: 'handle' | join: ',' }}{% endif %}" data-bogo-badge-text="{{ section.settings.bogo_badge_text }}" data-bogo-cart-text="{{ section.settings.bogo_cart_text }}">
    <div class="recommendations-layout">
        <!-- Left Side: Gift Product & Recommended Products -->
        <div class="recommendations-left">
            {% if section.settings.gift_product != blank %}
                {%- comment -%} Legacy single gift product {%- endcomment -%}
                <div class="gift-product-card" data-gift-product="{{ section.settings.gift_product.handle }}">
                    <div class="gift-card-body">
                        {% if section.settings.gift_banner_text != blank %}
                            <div class="gift-banner-top">{{ section.settings.gift_banner_text }}</div>
                        {% endif %}
                        <div class="gift-card-main">
                            <div class="gift-card-image">
                                {% if section.settings.gift_product.featured_image %}
                                    <img src="{{ section.settings.gift_product.featured_image | image_url: width: 600 }}" alt="{{ section.settings.gift_product.title }}">
                                {% endif %}
                                <h3 class="gift-product-title gift-product-title-mobile">{{ section.settings.gift_product.title }}</h3>
                            </div>
                            <div class="gift-card-content">
                                <h3 class="gift-product-title gift-product-title-desktop">
                                    {{ section.settings.gift_product.title }}
                                </h3>
                                {% if section.settings.gift_description != blank %}
                                    <p class="gift-product-description">{{ section.settings.gift_description }}</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}

            {%- comment -%} Mobile Gift Progress Section (Duplicate) {%- endcomment -%}
            {% if section.settings.gift_tiers_enabled %}
                <div class="gift-progress-section gift-progress-section-mobile" 
                    data-gift-progress-section-mobile
                    data-gift-tiers-enabled="true"
                    data-tier0-enabled="{{ section.settings.tier0_free_shipping_enabled | default: true }}"
                    data-tier0-text="{{ section.settings.tier0_free_shipping_text | default: 'Free Shipping' }}"
                    data-tier1-threshold="{{ section.settings.tier1_threshold | default: 100 }}"
                    data-tier1-female="{{ section.settings.tier1_gift_female.handle | default: '' }}"
                    data-tier1-variant-female="{{ section.settings.tier1_variant_female | default: '' }}"
                    data-tier1-male="{{ section.settings.tier1_gift_male.handle | default: '' }}"
                    data-tier1-variant-male="{{ section.settings.tier1_variant_male | default: '' }}"
                    data-tier1-banner="{{ section.settings.tier1_banner_text | default: 'FREE GIFT UNLOCKED!' }}"
                    data-tier1-description="{{ section.settings.tier1_description | default: '' }}"
                    data-tier2-threshold="{{ section.settings.tier2_threshold | default: 0 }}"
                    data-tier2-female="{{ section.settings.tier2_gift_female.handle | default: '' }}"
                    data-tier2-variant-female="{{ section.settings.tier2_variant_female | default: '' }}"
                    data-tier2-male="{{ section.settings.tier2_gift_male.handle | default: '' }}"
                    data-tier2-variant-male="{{ section.settings.tier2_variant_male | default: '' }}"
                    data-tier2-banner="{{ section.settings.tier2_banner_text | default: 'BONUS GIFT UNLOCKED!' }}"
                    data-tier2-description="{{ section.settings.tier2_description | default: '' }}"
                    data-tier3-threshold="{{ section.settings.tier3_threshold | default: 0 }}"
                    data-tier3-female="{{ section.settings.tier3_gift_female.handle | default: '' }}"
                    data-tier3-variant-female="{{ section.settings.tier3_variant_female | default: '' }}"
                    data-tier3-male="{{ section.settings.tier3_gift_male.handle | default: '' }}"
                    data-tier3-variant-male="{{ section.settings.tier3_variant_male | default: '' }}"
                    data-tier3-banner="{{ section.settings.tier3_banner_text | default: 'VIP GIFT UNLOCKED!' }}"
                    data-tier3-description="{{ section.settings.tier3_description | default: '' }}"
                    data-progress-text="{{ section.settings.gift_progress_text | default: 'Add [[remaining]] more to unlock your next gift!' }}"
                    data-complete-text="{{ section.settings.gift_complete_text | default: 'You have unlocked all free gifts!' }}"
                >
                    <div class="gift-progress-header">
                        <div class="gift-progress-header-content">
                            <div class="gift-progress-subtitle" data-gift-progress-label-mobile>{{ section.settings.gift_progress_text | default: 'Add items to unlock gifts!' }}</div>
                        </div>
                    </div>
                    <div class="gift-progress-bar-container">
                        <div class="gift-progress-bar-track">
                            <div class="gift-progress-bar" data-gift-progress-bar-mobile style="width: 0%"></div>
                            <div class="gift-progress-milestones" data-gift-milestones-mobile>
                                {%- comment -%} Milestones will be dynamically added by JS {%- endcomment -%}
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}

            {% if section.settings.title != blank or section.settings.subtitle != blank %}
                <div class="maison-quiz-recom-text">
                    {% if section.settings.title != blank %}
                        <p class="maison-quiz-recom-text-title">{{ section.settings.title }}</p>
                    {% endif %}
                    {% if section.settings.subtitle != blank %}
                        <div class="maison-quiz-recom-text-subtitle">{{ section.settings.subtitle }}</div>
                    {% endif %}
                </div>
            {% endif %}

            <div class="recommended-products-list" data-recommended-list>
                <!-- Section 1: Top 3 Picks (Auto-added to cart) -->
                <div class="recommendations-section" data-section="top-picks">
                    {% if section.settings.section1_title != blank %}
                        <h3 class="section-title">{{ section.settings.section1_title }}</h3>
                    {% endif %}
                    {% if section.settings.section1_description != blank %}
                        <div class="section-description">{{ section.settings.section1_description }}</div>
                    {% endif %}
                    <div class="section-products" data-section-products="top-picks"></div>
                </div>

                 <!-- Upsell Package Blocks -->
                {% for block in section.blocks %}
                    {% case block.type %}
                        {% when 'upsell_package' %}
                            <div class="maison_commerce_maison_upsell_package__block" {{ block.shopify_attributes }} data-upsell-package-block data-countdown-hours="{{ block.settings.countdown_hours | default: 0 }}" data-countdown-minutes="{{ block.settings.countdown_minutes | default: 9 }}" data-countdown-seconds="{{ block.settings.countdown_seconds | default: 57 }}">
                                <!-- Header -->
                                <div class="maison_commerce_maison_upsell_package__header">
                                    <div class="maison_commerce_maison_upsell_package__header-left">
                                        {% if block.settings.flame_icon != blank %}
                                            <img src="{{ block.settings.flame_icon | image_url: width: 20 }}" alt="" class="maison_commerce_maison_upsell_package__flame-icon">
                                        {% else %}
                                            <svg class="maison_commerce_maison_upsell_package__flame-icon" width="16" height="16" viewBox="0 0 20 20" fill="none">
                                                <path d="M10 2L12.5 7.5L18 8.5L14 12.5L15 18L10 15L5 18L6 12.5L2 8.5L7.5 7.5L10 2Z" fill="#E98C36"/>
                                            </svg>
                                        {% endif %}
                                        <span class="maison_commerce_maison_upsell_package__header-text">{{ block.settings.header_text | default: 'LIMITED-TIME CRAZY DEAL' }}</span>
                                    </div>
                                    <div class="maison_commerce_maison_upsell_package__timer" data-countdown-timer>
                                        <span class="timer-value" data-timer-hours>00</span>:<span class="timer-value" data-timer-minutes>00</span>:<span class="timer-value" data-timer-seconds>00</span>
                                    </div>
                                </div>

                                <!-- Main Content -->
                                <div class="maison_commerce_maison_upsell_package__content">
                                    <div class="maison_commerce_maison_upsell_package__content-main">
                                        {% if block.settings.product_image != blank %}
                                            <div class="maison_commerce_maison_upsell_package__image">
                                                <img src="{{ block.settings.product_image | image_url: width: 800 }}" alt="{{ block.settings.title }}">
                                            </div>
                                        {% endif %}
                                        <div class="maison_commerce_maison_upsell_package__text-content-top">
                                            <div class="maison_commerce_maison_upsell_package__text-content">
                                                {% if block.settings.title != blank %}
                                                    <h3 class="maison_commerce_maison_upsell_package__title">{{ block.settings.title }}</h3>
                                                {% endif %}
                                                {% if block.settings.discount_percent > 0 %}
                                                    <div class="maison_commerce_maison_upsell_package__discount-badge">SAVE {{ block.settings.discount_percent }}%</div>
                                                {% endif %}
                                            </div>
                                            {% if block.settings.description != blank %}
                                                <div class="maison_commerce_maison_upsell_package__description">{{ block.settings.description }}</div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="maison_commerce_maison_upsell_package__content-bottom">
                                        {% if block.settings.products != blank %}
                                            <button class="maison_commerce_maison_upsell_package__button" data-upsell-package-button data-product-handles="{% for product in block.settings.products %}{{ product.handle }}{% unless forloop.last %},{% endunless %}{% endfor %}" data-original-text="{{ block.settings.button_text | default: 'Claim Ultimate Package' }}">
                                                {{ block.settings.button_text | default: 'Claim Ultimate Package' }}
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                                                <path d="M5 12H19M19 12L12 5M19 12L12 19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                                </svg>
                                            </button>
                                        {% endif %}

                                        {% if block.settings.footer_text != blank %}
                                            <div class="maison_commerce_maison_upsell_package__footer">{{ block.settings.footer_text }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                    {% endcase %}
                {% endfor %}

                <!-- Section 2: Additional Recommendations (Not auto-added) -->
                <div class="recommendations-section" data-section="additional">
                    {% if section.settings.section2_title != blank %}
                        <h3 class="section-title">{{ section.settings.section2_title }}</h3>
                    {% endif %}
                    {% if section.settings.section2_description != blank %}
                        <div class="section-description">{{ section.settings.section2_description }}</div>
                    {% endif %}
                    <div class="section-products" data-section-products="additional"></div>
                </div>

                <hr class="section-divider">

                <!-- Section 3: Accessories (Manual products, not auto-added) -->
                <div class="recommendations-section" data-section="accessories">
                    {% if section.settings.section3_title != blank %}
                        <h3 class="section-title">{{ section.settings.section3_title }}</h3>
                    {% endif %}
                    {% if section.settings.section3_description != blank %}
                        <div class="section-description">{{ section.settings.section3_description }}</div>
                    {% endif %}
                    <div class="section-products" data-section-products="accessories"></div>
                </div>
            </div>
        </div>

        <!-- Right Side: Cart Summary -->
        <div class="recommendations-right">
            <div class="cart-summary">
                <div class="cart-summary-header">
                    <h3 class="cart-summary-title">Order Summary</h3>
                </div>
                <div class="cart-summary-body">
                    {%- comment -%} Gift Progress Section {%- endcomment -%}
                    {% if section.settings.gift_tiers_enabled %}
                        <div class="gift-progress-section" 
                            data-gift-progress-section
                            data-gift-tiers-enabled="true"
                            data-tier0-enabled="{{ section.settings.tier0_free_shipping_enabled | default: true }}"
                            data-tier0-text="{{ section.settings.tier0_free_shipping_text | default: 'Free Shipping' }}"
                            data-tier1-threshold="{{ section.settings.tier1_threshold | default: 100 }}"
                            data-tier1-female="{{ section.settings.tier1_gift_female.handle | default: '' }}"
                            data-tier1-variant-female="{{ section.settings.tier1_variant_female | default: '' }}"
                            data-tier1-male="{{ section.settings.tier1_gift_male.handle | default: '' }}"
                            data-tier1-variant-male="{{ section.settings.tier1_variant_male | default: '' }}"
                            data-tier1-banner="{{ section.settings.tier1_banner_text | default: 'FREE GIFT UNLOCKED!' }}"
                            data-tier1-description="{{ section.settings.tier1_description | default: '' }}"
                            data-tier2-threshold="{{ section.settings.tier2_threshold | default: 0 }}"
                            data-tier2-female="{{ section.settings.tier2_gift_female.handle | default: '' }}"
                            data-tier2-variant-female="{{ section.settings.tier2_variant_female | default: '' }}"
                            data-tier2-male="{{ section.settings.tier2_gift_male.handle | default: '' }}"
                            data-tier2-variant-male="{{ section.settings.tier2_variant_male | default: '' }}"
                            data-tier2-banner="{{ section.settings.tier2_banner_text | default: 'BONUS GIFT UNLOCKED!' }}"
                            data-tier2-description="{{ section.settings.tier2_description | default: '' }}"
                            data-tier3-threshold="{{ section.settings.tier3_threshold | default: 0 }}"
                            data-tier3-female="{{ section.settings.tier3_gift_female.handle | default: '' }}"
                            data-tier3-variant-female="{{ section.settings.tier3_variant_female | default: '' }}"
                            data-tier3-male="{{ section.settings.tier3_gift_male.handle | default: '' }}"
                            data-tier3-variant-male="{{ section.settings.tier3_variant_male | default: '' }}"
                            data-tier3-banner="{{ section.settings.tier3_banner_text | default: 'VIP GIFT UNLOCKED!' }}"
                            data-tier3-description="{{ section.settings.tier3_description | default: '' }}"
                            data-progress-text="{{ section.settings.gift_progress_text | default: 'Add [[remaining]] more to unlock your next gift!' }}"
                            data-complete-text="{{ section.settings.gift_complete_text | default: 'You have unlocked all free gifts!' }}"
                        >
                            <div class="gift-progress-header">
                                <div class="gift-progress-header-content">
                                    <div class="gift-progress-subtitle" data-gift-progress-label>{{ section.settings.gift_progress_text | default: 'Add items to unlock gifts!' }}</div>
                                </div>
                            </div>
                            <div class="gift-progress-bar-container">
                                <div class="gift-progress-bar-track">
                                    <div class="gift-progress-bar" data-gift-progress-bar style="width: 0%"></div>
                                    <div class="gift-progress-milestones" data-gift-milestones>
                                        {%- comment -%} Milestones will be dynamically added by JS {%- endcomment -%}
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                    <div class="cart-items" data-cart-items>
                        <!-- Cart items will be added here dynamically -->
                    </div>
                    <div class="cart-summary-totals">
                        <div class="cart-summary-row">
                            <span>Subtotal:</span>
                            <span data-subtotal>$0.00</span>
                        </div>
                        <div class="cart-summary-row cart-discount-row" data-discount-row style="display: none;">
                            <span>Discount:</span>
                            <span data-discount>- $0.00</span>
                        </div>
                        <div class="cart-summary-row">
                            <span>VAT:</span>
                            <span>Calculated at checkout</span>
                        </div>
                        <div class="cart-summary-row">
                            <span>Shipping:</span>
                            <span id="shipping-status" style="font-weight: bold;">Paid</span>
                        </div>
                    </div>
                    <div class="cart-total-section">
                        <div class="cart-total-label">Total Price (with savings)</div>
                        <div class="cart-total-price">
                            <span class="cart-total-original" data-total-original style="display: none;">$0.00</span>
                            <span class="cart-total-current" data-total-current>$0.00</span>
                        </div>
                    </div>
                    <button class="quiz-btn quiz-btn-checkout" data-checkout-btn>
                        Checkout
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
                            <g clip-path="url(#clip0_10099_18200)">
                                <path d="M14.625 7.125H14.0625V5.0625C14.0625 3.71984 13.5291 2.43217 12.5797 1.48277C11.6303 0.533369 10.3427 0 9 0C7.65734 0 6.36967 0.533369 5.42027 1.48277C4.47087 2.43217 3.9375 3.71984 3.9375 5.0625V7.125H3.375C2.97718 7.125 2.59564 7.28303 2.31434 7.56434C2.03304 7.84564 1.875 8.22717 1.875 8.625V16.5C1.875 16.8978 2.03304 17.2794 2.31434 17.5607C2.59564 17.842 2.97718 18 3.375 18H14.625C15.0228 18 15.4044 17.842 15.6857 17.5607C15.967 17.2794 16.125 16.8978 16.125 16.5V8.625C16.125 8.22717 15.967 7.84564 15.6857 7.56434C15.4044 7.28303 15.0228 7.125 14.625 7.125ZM9 13.875C8.70333 13.875 8.41332 13.787 8.16665 13.6222C7.91997 13.4574 7.72771 13.2231 7.61418 12.949C7.50065 12.6749 7.47094 12.3733 7.52882 12.0824C7.5867 11.7914 7.72956 11.5241 7.93934 11.3143C8.14912 11.1046 8.41639 10.9617 8.70736 10.9038C8.99834 10.8459 9.29994 10.8756 9.57403 10.9892C9.84811 11.1027 10.0824 11.295 10.2472 11.5416C10.412 11.7883 10.5 12.0783 10.5 12.375C10.5 12.572 10.4612 12.767 10.3858 12.949C10.3104 13.131 10.1999 13.2964 10.0607 13.4357C9.92137 13.5749 9.75601 13.6854 9.57403 13.7608C9.39204 13.8362 9.19698 13.875 9 13.875ZM12.1875 6.75C12.1875 6.79925 12.1778 6.84801 12.159 6.89351C12.1401 6.939 12.1125 6.98034 12.0777 7.01516C12.0428 7.04999 12.0015 7.07761 11.956 7.09646C11.9105 7.1153 11.8617 7.125 11.8125 7.125H6.1875C6.08804 7.125 5.99266 7.08549 5.92234 7.01516C5.85201 6.94484 5.8125 6.84946 5.8125 6.75V5.0625C5.8125 4.21712 6.14833 3.40637 6.7461 2.8086C7.34387 2.21082 8.15462 1.875 9 1.875C9.84538 1.875 10.6561 2.21082 11.2539 2.8086C11.8517 3.40637 12.1875 4.21712 12.1875 5.0625V6.75Z" fill="#F7F7FC"/>
                            </g>
                            <defs>
                                <clipPath id="clip0_10099_18200">
                                <rect width="18" height="18" fill="white"/>
                                </clipPath>
                            </defs>
                        </svg>
                    </button>
                    {% if section.settings.checkout_subtext != blank %}
                        <div class="checkout-subtext">{{ section.settings.checkout_subtext }}</div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Mobile Sticky Bar -->
        <div class="mobile-sticky-bar">
            <div class="mobile-sticky-bar-content">
                <div class="mobile-sticky-bar-total">
                    <div class="cart-total-wrapper">
                        <span class="mobile-sticky-bar-label">Total Price (with savings)</span>
                        <button class="mobile-sticky-bar-open-menu" aria-label="Open cart summary">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="9" viewBox="0 0 18 9" fill="none">
                                <g clip-path="url(#clip0_10099_16556)">
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M8.46628 7.6177L4.22353 3.37495L5.28403 2.31445L8.99653 6.02695L12.709 2.31445L13.7695 3.37495L9.52678 7.6177C9.38614 7.75831 9.1954 7.83729 8.99653 7.83729C8.79766 7.83729 8.60693 7.75831 8.46628 7.6177Z" fill="black" fill-opacity="0.5"/>
                                </g>
                                <defs>
                                    <clipPath id="clip0_10099_16556">
                                    <rect width="9" height="18" fill="white" transform="matrix(0 1 -1 0 18 0)"/>
                                    </clipPath>
                                </defs>
                            </svg>
                        </button>
                    </div>
                    <div class="mobile-sticky-bar-price-wrapper">
                        <span class="mobile-sticky-bar-price-original" data-mobile-total-original style="display: none;">$0.00</span>
                        <span class="mobile-sticky-bar-price" data-mobile-total-current>$0.00</span>
                    </div>
                </div>
                <button class="mobile-sticky-bar-checkout quiz-btn-checkout" data-checkout-btn>
                    Checkout
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                        <g clip-path="url(#clip0_10099_165812)">
                            <path d="M12.9993 6.33333H12.4993V4.5C12.4993 3.30653 12.0252 2.16193 11.1813 1.31802C10.3374 0.474106 9.19282 0 7.99935 0C6.80587 0 5.66128 0.474106 4.81737 1.31802C3.97345 2.16193 3.49935 3.30653 3.49935 4.5V6.33333H2.99935C2.64573 6.33333 2.30659 6.47381 2.05654 6.72386C1.80649 6.97391 1.66602 7.31304 1.66602 7.66667V14.6667C1.66602 15.0203 1.80649 15.3594 2.05654 15.6095C2.30659 15.8595 2.64573 16 2.99935 16H12.9993C13.353 16 13.6921 15.8595 13.9422 15.6095C14.1922 15.3594 14.3327 15.0203 14.3327 14.6667V7.66667C14.3327 7.31304 14.1922 6.97391 13.9422 6.72386C13.6921 6.47381 13.353 6.33333 12.9993 6.33333ZM7.99935 12.3333C7.73564 12.3333 7.47785 12.2551 7.25859 12.1086C7.03932 11.9621 6.86843 11.7539 6.76751 11.5102C6.66659 11.2666 6.64019 10.9985 6.69164 10.7399C6.74308 10.4812 6.87007 10.2437 7.05654 10.0572C7.24301 9.87072 7.48059 9.74373 7.73923 9.69229C7.99787 9.64084 8.26596 9.66724 8.50959 9.76816C8.75323 9.86908 8.96147 10.04 9.10798 10.2592C9.25448 10.4785 9.33268 10.7363 9.33268 11C9.33268 11.1751 9.29819 11.3485 9.23119 11.5102C9.16418 11.672 9.06597 11.819 8.94216 11.9428C8.81835 12.0666 8.67136 12.1648 8.50959 12.2318C8.34783 12.2988 8.17445 12.3333 7.99935 12.3333ZM10.8327 6C10.8327 6.04377 10.8241 6.08712 10.8073 6.12756C10.7906 6.168 10.766 6.20475 10.7351 6.2357C10.7041 6.26665 10.6674 6.29121 10.6269 6.30796C10.5865 6.32471 10.5431 6.33333 10.4993 6.33333H5.49935C5.41094 6.33333 5.32616 6.29821 5.26365 6.2357C5.20113 6.17319 5.16602 6.08841 5.16602 6V4.5C5.16602 3.74855 5.46453 3.02788 5.99588 2.49653C6.52723 1.96518 7.2479 1.66667 7.99935 1.66667C8.7508 1.66667 9.47147 1.96518 10.0028 2.49653C10.5342 3.02788 10.8327 3.74855 10.8327 4.5V6Z" fill="#F7F7FC"/>
                        </g>
                        <defs>
                            <clipPath id="clip0_10099_165812">
                            <rect width="16" height="16" fill="white"/>
                            </clipPath>
                        </defs>
                    </svg>
                </button>
                {% if section.settings.checkout_subtext != blank %}
                    <div class="checkout-subtext">{{ section.settings.checkout_subtext }}</div>
                {% endif %}
            </div>
        </div>

        <!-- Mobile Cart Summary Popup -->
        <div class="mobile-cart-popup" id="mobile-cart-popup" style="display: none;">
            <div class="mobile-cart-popup-overlay"></div>
            <div class="mobile-cart-popup-content">
                <div class="mobile-cart-popup-header">
                    <h3 class="mobile-cart-popup-title">Order Summary</h3>
                    <button class="mobile-cart-popup-close" aria-label="Close cart summary">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
                <div class="mobile-cart-popup-body">
                    {%- comment -%} Gift Progress Section {%- endcomment -%}
                    {% if section.settings.gift_tiers_enabled %}
                        <div class="gift-progress-section mobile-cart-popup-gift-progress" 
                            data-gift-progress-section-mobile-popup
                            data-gift-tiers-enabled="true"
                            data-tier0-enabled="{{ section.settings.tier0_free_shipping_enabled | default: true }}"
                            data-tier0-text="{{ section.settings.tier0_free_shipping_text | default: 'Free Shipping' }}"
                            data-tier1-threshold="{{ section.settings.tier1_threshold | default: 100 }}"
                            data-tier1-female="{{ section.settings.tier1_gift_female.handle | default: '' }}"
                            data-tier1-variant-female="{{ section.settings.tier1_variant_female | default: '' }}"
                            data-tier1-male="{{ section.settings.tier1_gift_male.handle | default: '' }}"
                            data-tier1-variant-male="{{ section.settings.tier1_variant_male | default: '' }}"
                            data-tier1-banner="{{ section.settings.tier1_banner_text | default: 'FREE GIFT UNLOCKED!' }}"
                            data-tier1-description="{{ section.settings.tier1_description | default: '' }}"
                            data-tier2-threshold="{{ section.settings.tier2_threshold | default: 0 }}"
                            data-tier2-female="{{ section.settings.tier2_gift_female.handle | default: '' }}"
                            data-tier2-variant-female="{{ section.settings.tier2_variant_female | default: '' }}"
                            data-tier2-male="{{ section.settings.tier2_gift_male.handle | default: '' }}"
                            data-tier2-variant-male="{{ section.settings.tier2_variant_male | default: '' }}"
                            data-tier2-banner="{{ section.settings.tier2_banner_text | default: 'BONUS GIFT UNLOCKED!' }}"
                            data-tier2-description="{{ section.settings.tier2_description | default: '' }}"
                            data-tier3-threshold="{{ section.settings.tier3_threshold | default: 0 }}"
                            data-tier3-female="{{ section.settings.tier3_gift_female.handle | default: '' }}"
                            data-tier3-variant-female="{{ section.settings.tier3_variant_female | default: '' }}"
                            data-tier3-male="{{ section.settings.tier3_gift_male.handle | default: '' }}"
                            data-tier3-variant-male="{{ section.settings.tier3_variant_male | default: '' }}"
                            data-tier3-banner="{{ section.settings.tier3_banner_text | default: 'VIP GIFT UNLOCKED!' }}"
                            data-tier3-description="{{ section.settings.tier3_description | default: '' }}"
                            data-progress-text="{{ section.settings.gift_progress_text | default: 'Add [[remaining]] more to unlock your next gift!' }}"
                            data-complete-text="{{ section.settings.gift_complete_text | default: 'You have unlocked all free gifts!' }}"
                        >
                            <div class="gift-progress-header">
                                <div class="gift-progress-header-content">
                                    <div class="gift-progress-subtitle" data-gift-progress-label-popup>{{ section.settings.gift_progress_text | default: 'Add items to unlock gifts!' }}</div>
                                </div>
                            </div>
                            <div class="gift-progress-bar-container">
                                <div class="gift-progress-bar-track">
                                    <div class="gift-progress-bar" data-gift-progress-bar-popup style="width: 0%"></div>
                                    <div class="gift-progress-milestones" data-gift-milestones-popup>
                                        {%- comment -%} Milestones will be dynamically added by JS {%- endcomment -%}
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                    <div class="cart-items" data-cart-items-popup>
                        <!-- Cart items will be added here dynamically -->
                    </div>
                    <div class="cart-summary-totals">
                        <div class="cart-summary-row">
                            <span>Subtotal:</span>
                            <span data-subtotal-popup>$0.00</span>
                        </div>
                        <div class="cart-summary-row cart-discount-row" data-discount-row-popup style="display: none;">
                            <span>Discount:</span>
                            <span data-discount-popup>- $0.00</span>
                        </div>
                        <div class="cart-summary-row">
                            <span>VAT:</span>
                            <span>Calculated at checkout</span>
                        </div>
                        <div class="cart-summary-row">
                            <span>Shipping:</span>
                            <span id="shipping-status-popup" style="font-weight: bold;">Paid</span>
                        </div>
                    </div>
                    <div class="cart-total-section">
                        <div class="cart-total-label">Total Price (with savings)</div>
                        <div class="cart-total-price">
                            <span class="cart-total-original" data-total-original-popup style="display: none;">$0.00</span>
                            <span class="cart-total-current" data-total-current-popup>$0.00</span>
                        </div>
                    </div>
                    <button class="quiz-btn quiz-btn-checkout" data-checkout-btn-popup>
                        Checkout
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
                            <g clip-path="url(#clip0_10099_18200)">
                                <path d="M14.625 7.125H14.0625V5.0625C14.0625 3.71984 13.5291 2.43217 12.5797 1.48277C11.6303 0.533369 10.3427 0 9 0C7.65734 0 6.36967 0.533369 5.42027 1.48277C4.47087 2.43217 3.9375 3.71984 3.9375 5.0625V7.125H3.375C2.97718 7.125 2.59564 7.28303 2.31434 7.56434C2.03304 7.84564 1.875 8.22717 1.875 8.625V16.5C1.875 16.8978 2.03304 17.2794 2.31434 17.5607C2.59564 17.842 2.97718 18 3.375 18H14.625C15.0228 18 15.4044 17.842 15.6857 17.5607C15.967 17.2794 16.125 16.8978 16.125 16.5V8.625C16.125 8.22717 15.967 7.84564 15.6857 7.56434C15.4044 7.28303 15.0228 7.125 14.625 7.125ZM9 13.875C8.70333 13.875 8.41332 13.787 8.16665 13.6222C7.91997 13.4574 7.72771 13.2231 7.61418 12.949C7.50065 12.6749 7.47094 12.3733 7.52882 12.0824C7.5867 11.7914 7.72956 11.5241 7.93934 11.3143C8.14912 11.1046 8.41639 10.9617 8.70736 10.9038C8.99834 10.8459 9.29994 10.8756 9.57403 10.9892C9.84811 11.1027 10.0824 11.295 10.2472 11.5416C10.412 11.7883 10.5 12.0783 10.5 12.375C10.5 12.572 10.4612 12.767 10.3858 12.949C10.3104 13.131 10.1999 13.2964 10.0607 13.4357C9.92137 13.5749 9.75601 13.6854 9.57403 13.7608C9.39204 13.8362 9.19698 13.875 9 13.875ZM12.1875 6.75C12.1875 6.79925 12.1778 6.84801 12.159 6.89351C12.1401 6.939 12.1125 6.98034 12.0777 7.01516C12.0428 7.04999 12.0015 7.07761 11.956 7.09646C11.9105 7.1153 11.8617 7.125 11.8125 7.125H6.1875C6.08804 7.125 5.99266 7.08549 5.92234 7.01516C5.85201 6.94484 5.8125 6.84946 5.8125 6.75V5.0625C5.8125 4.21712 6.14833 3.40637 6.7461 2.8086C7.34387 2.21082 8.15462 1.875 9 1.875C9.84538 1.875 10.6561 2.21082 11.2539 2.8086C11.8517 3.40637 12.1875 4.21712 12.1875 5.0625V6.75Z" fill="#F7F7FC"/>
                            </g>
                            <defs>
                                <clipPath id="clip0_10099_18200">
                                <rect width="18" height="18" fill="white"/>
                                </clipPath>
                            </defs>
                        </svg>
                    </button>
                    {% if section.settings.checkout_subtext != blank %}
                        <div class="checkout-subtext">{{ section.settings.checkout_subtext }}</div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

{{ 'quiz-recommendations.css' | asset_url | stylesheet_tag: preload: true }}

<script src="{{ 'quiz-recommendations.js' | asset_url }}" defer></script>

<script>
(function() {
    // Pass Liquid variables to external script
    window.quizRecommendationsConfig = {
        accessoryHandles: {{ section.settings.accessories_products | json }}
    };
    
    // External script will handle initialization
})();
</script>

{% schema %}
{
    "name": "Quiz Recommendations",
    "class": "quiz-section",
    "settings": [
        {
            "type": "text",
            "id": "title",
            "label": "Title",
            "default": "Your Personalized Recommendations"
        },
        {
            "type": "richtext",
            "id": "subtitle",
            "label": "Subtitle"
        },
        {
            "type": "header",
            "content": "Product Order"
        },
        {
            "type": "product_list",
            "id": "product_sort_order",
            "label": "Custom Product Order (Optional)",
            "info": "Set the display order of recommended products. Only products that were recommended by the quiz will be shown, in the order specified here. Leave empty to use default quiz order.",
            "limit": 20
        },
        {
            "type": "header",
            "content": "Section 1: Top Picks"
        },
        {
            "type": "text",
            "id": "section1_title",
            "label": "Section 1 Title",
            "default": "Our Top 3 Picks For You"
        },
        {
            "type": "richtext",
            "id": "section1_description",
            "label": "Section 1 Description",
            "info": "First 3 quiz recommendations, auto-added to cart"
        },
        {
            "type": "header",
            "content": "Section 2: Additional Recommendations"
        },
        {
            "type": "text",
            "id": "section2_title",
            "label": "Section 2 Title",
            "default": "Transform your routine into a ritual"
        },
        {
            "type": "richtext",
            "id": "section2_description",
            "label": "Section 2 Description",
            "info": "Remaining quiz recommendations, not auto-added to cart"
        },
        {
            "type": "header",
            "content": "Section 3: Accessories"
        },
        {
            "type": "text",
            "id": "section3_title",
            "label": "Section 3 Title",
            "default": "Hair Accessories You didn't know Your Hair Needed"
        },
        {
            "type": "richtext",
            "id": "section3_description",
            "label": "Section 3 Description",
            "info": "Manual product selection, not auto-added to cart"
        },
        {
            "type": "product_list",
            "id": "accessories_products",
            "label": "Accessory Products",
            "info": "Select products to display in the accessories section"
        },
        {
            "type": "header",
            "content": "Tiered Gift System"
        },
        {
            "type": "checkbox",
            "id": "gift_tiers_enabled",
            "label": "Enable Tiered Gifts",
            "default": false,
            "info": "Enable to show tiered free gifts based on cart total"
        },
        {
            "type": "richtext",
            "id": "gift_progress_text",
            "label": "Progress Bar Text",
            "default": "<p>üéÅ  <strong>[[current_gift]]</strong> added! Spend [[remaining]] more to get [[next_gift]]</p>",
            "info": "Use [[remaining]] for amount needed, [[current]] for current total, [[next_tier]] for next tier threshold, [[current_gift]] for current gift name, [[next_gift]] for next gift name"
        },
        {
            "type": "text",
            "id": "gift_complete_text",
            "label": "All Tiers Complete Text",
            "default": "You've unlocked all free gifts!",
            "info": "Shown when all gift tiers have been reached"
        },
        {
            "type": "color",
            "id": "gift_progress_bar_color",
            "label": "Progress Bar Color",
            "default": "#d4ff6a"
        },
        {
            "type": "color",
            "id": "gift_progress_bar_bg_color",
            "label": "Progress Bar Background Color",
            "default": "#e5e7eb"
        },
        {
            "type": "color",
            "id": "gift_milestone_color",
            "label": "Milestone Reached Color",
            "default": "#d4ff6a"
        },
        {
            "type": "header",
            "content": "Tier 0: Free Shipping"
        },
        {
            "type": "checkbox",
            "id": "tier0_free_shipping_enabled",
            "label": "Enable Free Shipping Gift",
            "default": true,
            "info": "Free shipping gift activates when cart has at least 1 item"
        },
        {
            "type": "text",
            "id": "tier0_free_shipping_text",
            "label": "Free Shipping Text",
            "default": "Free Shipping",
            "info": "Text to display for free shipping gift"
        },
        {
            "type": "header",
            "content": "Tier 1 Gift"
        },
        {
            "type": "number",
            "id": "tier1_threshold",
            "label": "Tier 1 - Minimum Cart Total",
            "default": 100,
            "info": "Cart total (in base currency, e.g. EUR) needed to unlock Tier 1 gift"
        },
        {
            "type": "product",
            "id": "tier1_gift_female",
            "label": "Tier 1 - Gift Product (Female)"
        },
        {
            "type": "text",
            "id": "tier1_variant_female",
            "label": "Tier 1 - Variant ID (Female)",
            "info": "Optional: Enter the variant ID to use a specific variant. Leave empty for default variant."
        },
        {
            "type": "product",
            "id": "tier1_gift_male",
            "label": "Tier 1 - Gift Product (Male)"
        },
        {
            "type": "text",
            "id": "tier1_variant_male",
            "label": "Tier 1 - Variant ID (Male)",
            "info": "Optional: Enter the variant ID to use a specific variant. Leave empty for default variant."
        },
        {
            "type": "text",
            "id": "tier1_banner_text",
            "label": "Tier 1 - Banner Text",
            "default": "FREE GIFT UNLOCKED!"
        },
        {
            "type": "textarea",
            "id": "tier1_description",
            "label": "Tier 1 - Gift Description",
            "default": "Complimentary with your purchase"
        },
        {
            "type": "header",
            "content": "Tier 2 Gift"
        },
        {
            "type": "number",
            "id": "tier2_threshold",
            "label": "Tier 2 - Minimum Cart Total",
            "default": 150,
            "info": "Cart total (in base currency, e.g. EUR) needed to unlock Tier 2 gift (set to 0 to disable)"
        },
        {
            "type": "product",
            "id": "tier2_gift_female",
            "label": "Tier 2 - Gift Product (Female)"
        },
        {
            "type": "text",
            "id": "tier2_variant_female",
            "label": "Tier 2 - Variant ID (Female)",
            "info": "Optional: Enter the variant ID to use a specific variant. Leave empty for default variant."
        },
        {
            "type": "product",
            "id": "tier2_gift_male",
            "label": "Tier 2 - Gift Product (Male)"
        },
        {
            "type": "text",
            "id": "tier2_variant_male",
            "label": "Tier 2 - Variant ID (Male)",
            "info": "Optional: Enter the variant ID to use a specific variant. Leave empty for default variant."
        },
        {
            "type": "text",
            "id": "tier2_banner_text",
            "label": "Tier 2 - Banner Text",
            "default": "BONUS GIFT UNLOCKED!"
        },
        {
            "type": "textarea",
            "id": "tier2_description",
            "label": "Tier 2 - Gift Description",
            "default": "Extra reward for your order"
        },
        {
            "type": "header",
            "content": "Tier 3 Gift"
        },
        {
            "type": "number",
            "id": "tier3_threshold",
            "label": "Tier 3 - Minimum Cart Total",
            "default": 200,
            "info": "Cart total (in base currency, e.g. EUR) needed to unlock Tier 3 gift (set to 0 to disable)"
        },
        {
            "type": "product",
            "id": "tier3_gift_female",
            "label": "Tier 3 - Gift Product (Female)"
        },
        {
            "type": "text",
            "id": "tier3_variant_female",
            "label": "Tier 3 - Variant ID (Female)",
            "info": "Optional: Enter the variant ID to use a specific variant. Leave empty for default variant."
        },
        {
            "type": "product",
            "id": "tier3_gift_male",
            "label": "Tier 3 - Gift Product (Male)"
        },
        {
            "type": "text",
            "id": "tier3_variant_male",
            "label": "Tier 3 - Variant ID (Male)",
            "info": "Optional: Enter the variant ID to use a specific variant. Leave empty for default variant."
        },
        {
            "type": "text",
            "id": "tier3_banner_text",
            "label": "Tier 3 - Banner Text",
            "default": "VIP GIFT UNLOCKED!"
        },
        {
            "type": "textarea",
            "id": "tier3_description",
            "label": "Tier 3 - Gift Description",
            "default": "Thank you for your loyalty"
        },
        {
            "type": "header",
            "content": "Legacy Gift Product (deprecated)"
        },
        {
            "type": "product",
            "id": "gift_product",
            "label": "Gift Product (optional)",
            "info": "Deprecated - use Tiered Gift System above instead"
        },
        {
            "type": "text",
            "id": "gift_banner_text",
            "label": "Gift Banner Text",
            "default": "FREE GIFT ADDED TO YOUR CART",
            "info": "Text shown in the top bar of the gift product card"
        },
        {
            "type": "textarea",
            "id": "gift_description",
            "label": "Gift Description",
            "default": "Complimentary with your purchase"
        },
        {
            "type": "header",
            "content": "Black Friday BOGO Promo"
        },
        {
            "type": "checkbox",
            "id": "bogo_enabled",
            "label": "Enable BOGO Promo",
            "default": false,
            "info": "Turn on/off the Buy One Get One Free promotion"
        },
        {
            "type": "product_list",
            "id": "bogo_products",
            "label": "BOGO Eligible Products",
            "info": "Select products that are eligible for Buy One Get One Free (one-time purchases only, not subscriptions)",
            "limit": 20
        },
        {
            "type": "text",
            "id": "bogo_badge_text",
            "label": "BOGO Badge Text",
            "default": "BUY 1 GET 1 FREE",
            "info": "Text shown on product card badges"
        },
        {
            "type": "text",
            "id": "bogo_cart_text",
            "label": "BOGO Cart Text",
            "default": "Buy 1 Get 1 Free",
            "info": "Text shown in cart for BOGO items"
        },
        {
            "type": "header",
            "content": "Colors"
        },
        {
            "type": "color",
            "id": "primary_color",
            "label": "Primary Color",
            "default": "#000000"
        },
        {
            "type": "color",
            "id": "text_color",
            "label": "Text Color",
            "default": "#111827"
        },
        {
            "type": "color",
            "id": "highlight_color",
            "label": "Highlight Color",
            "default": "#d4ff6a",
            "info": "Used for gift banner and highlight boxes"
        },
        {
            "type": "color",
            "id": "button_color",
            "label": "Button Background Color",
            "default": "#000000"
        },
        {
            "type": "color",
            "id": "button_text_color",
            "label": "Button Text Color",
            "default": "#ffffff"
        },
        {
            "type": "text",
            "id": "button_border_radius",
            "label": "Button Border Radius",
            "default": "5rem",
            "info": "CSS value for button border radius (e.g., 5rem, 8px, 50%)"
        },
        {
            "type": "color",
            "id": "remove_button_color",
            "label": "Remove Button Background Color",
            "default": "#ef4444"
        },
        {
            "type": "color",
            "id": "remove_button_text_color",
            "label": "Remove Button Text Color",
            "default": "#ffffff"
        },
        {
            "type": "color",
            "id": "checkout_button_color",
            "label": "Checkout Button Background Color",
            "default": "#22c55e",
            "info": "Background color for the checkout button"
        },
        {
            "type": "color",
            "id": "checkout_button_text_color",
            "label": "Checkout Button Text Color",
            "default": "#ffffff",
            "info": "Text color for the checkout button"
        },
        {
            "type": "color",
            "id": "background_color",
            "label": "Background Color",
            "default": "#f0f0ff"
        },
        {
            "type": "text",
            "id": "checkout_subtext",
            "label": "Checkout Subtext",
            "info": "Text displayed under the main checkout button.",
            "default": "if you don't like your first order it will be on us"
        }
    ],
    "blocks": [
        {
            "type": "upsell_package",
            "name": "Upsell Package",
            "settings": [
                {
                    "type": "header",
                    "content": "Content"
                },
                {
                    "type": "image_picker",
                    "id": "product_image",
                    "label": "Product Image"
                },
                {
                    "type": "image_picker",
                    "id": "flame_icon",
                    "label": "Flame Icon (Optional)",
                    "info": "Custom icon for header. If not set, default SVG icon will be used."
                },
                {
                    "type": "text",
                    "id": "header_text",
                    "label": "Header Text",
                    "default": "LIMITED-TIME CRAZY DEAL"
                },
                {
                    "type": "text",
                    "id": "title",
                    "label": "Title",
                    "default": "Ultimate Hair Care Package"
                },
                {
                    "type": "richtext",
                    "id": "description",
                    "label": "Description",
                    "default": "<p>Get all 7 products ‚Äî more than our top 3 bestsellers ‚Äî with <strong>50% off</strong>. This is a one-time purchase with no subscription. A limited-time offer we may not keep for long.</p>"
                },
                {
                    "type": "range",
                    "id": "discount_percent",
                    "min": 0,
                    "max": 100,
                    "step": 5,
                    "unit": "%",
                    "label": "Discount Percent",
                    "default": 50
                },
                {
                    "type": "product_list",
                    "id": "products",
                    "label": "Products",
                    "info": "Select products to add to cart when button is clicked",
                    "limit": 20
                },
                {
                    "type": "text",
                    "id": "button_text",
                    "label": "Button Text",
                    "default": "Claim Ultimate Package"
                },
                {
                    "type": "text",
                    "id": "footer_text",
                    "label": "Footer Text",
                    "default": "No subscription ‚Ä¢ One-time payment ‚Ä¢ Limited availability"
                },
                {
                    "type": "header",
                    "content": "Countdown Timer"
                },
                {
                    "type": "number",
                    "id": "countdown_hours",
                    "label": "Countdown Hours",
                    "default": 0
                },
                {
                    "type": "number",
                    "id": "countdown_minutes",
                    "label": "Countdown Minutes",
                    "default": 9
                },
                {
                    "type": "number",
                    "id": "countdown_seconds",
                    "label": "Countdown Seconds",
                    "default": 57
                }
            ]
        }
    ],
    "presets": [
        {
            "name": "Quiz Recommendations"
        }
    ]
}
{% endschema %}